\ProvidesFile{lawcite.cbx}[2020-04-11 v1.0 biblatex citation lawcite style]
\RequireCitationStyle{ext-authortitle-ibid}

% commands
\newcommand\statutetitleyeardelim{\addspace}
\newcommand\statutejurisdictiondelim{\addspace}

%for Table of Cases
\newcommand\mncreportdelimiter{}
\newcommand\setmncreportdelimiter[1]{%
\renewcommand\mncreportdelimiter{\addcomma\addspace}}


%for tracing
\newcommand\ttt{\textcolor{red}{AA}}

%====================================================
%\DeclareListFormat{location}{%
%#1%
%\ifthenelse{\value{listcount}<\value{liststop}}
%{\addcomma\space}
%{}}

%\printlist[hformati][hstarti–hstopi]{hliteral listi}

%This command loops over all items in a hliteral listi, starting at item number hstarti
%and stopping at item number hstopi, including hstarti and hstopi (all lists are numbered
%starting at 1). Each item is printed using the formatting directive hformati,
%as defined with \DeclareListFormat. If a type-specific hformati has been
%declared, the type-specific formatting directive takes precedence over the generic
%one. If the hliteral listi is undefined, nothing is printed. If the hformati is omitted,
%\printlist tries using the name of the list as a format name.


%\DeclareListWrapperFormat[hentrytype, …i]{hformati}{hcodei}
%\DeclareListWrapperFormat*{hformati}{hcodei}
%
%Defines the list wrapper format hformati. This formatting directive is arbitrary hcodei
%to be executed once for the entire list processed by \printlist. The name of the
%literal list currently being processed is available to the hcodei as \currentlist.
%If an hentrytypei is specified, the format is specific to that type. The hentrytypei
%argument may be a comma-separated list of values. The starred variant of this
%command















% fieldformats: case
\DeclareFieldFormat{partya}{\iftoggle{partynamesitalic}{\mkbibemph{#1}}{#1}}
\DeclareFieldFormat{partyb}{\iftoggle{partynamesitalic}{\mkbibemph{#1}}{#1}}
\DeclareFieldFormat{shipname}{\mkbibemph{#1}}%
\DeclareFieldFormat{caseshortname}{%
		\iftoggle{partynamesitalic}%
		{\mkbibemph{#1}}%
		{#1}%
		}
\DeclareFieldFormat{casenickname}{\mkbibquote{#1\addspace\bibstring{case}}}

\DeclareFieldFormat{partyasn}{\iftoggle{partynamesitalic}{\mkbibemph{#1}}{#1}}
\DeclareFieldFormat{partybsn}{\iftoggle{partynamesitalic}{\mkbibemph{#1}}{#1}}
\DeclareFieldFormat{partyajur}{\mkbibparens{\iftoggle{partynamesitalic}{\mkbibemph{#1}}{#1}}}
\DeclareFieldFormat{partybjur}{\mkbibparens{\iftoggle{partynamesitalic}{\mkbibemph{#1}}{#1}}}

\DeclareFieldFormat{quotetext}{\mkbibquote{#1}}
\DeclareFieldFormat[case]{casestatus}{#1}
\DeclareFieldFormat[case]{courtfullname}{#1}






\DeclareFieldFormat{decisionyear}{\mkbibparens{#1}}


\DeclareFieldFormat{partysep}{%
%#1
\iftoggle{partysepitalic}{%true
\mkbibemph{#1}{\iftoggle{partysepdotted}{\adddot}{}}%
}%end true
{%false
#1{\iftoggle{partysepdotted}{\adddot}{}}%
}%end false
}%end


\DeclareFieldFormat{caseyear}{%
\iffieldundef{casenumber}{#1}{\iftoggle{mncbrackets}{\mkbibbrackets{#1}}{#1}}}%make option
\DeclareFieldFormat{courtname}{#1}
\DeclareFieldFormat{casenumber}{#1}

\DeclareFieldFormat{reportyear}{#1}
\DeclareFieldFormat{reportvolume}{#1}
\DeclareFieldFormat{reportseries}{#1}
\DeclareFieldFormat{reportpage}{#1}



% fieldformats: statute

\DeclareFieldFormat{statutetitle}{\mkbibemph{#1}}
\DeclareFieldFormat{statutelongtitle}{#1}
\DeclareFieldFormat{statuteshorttitle}{#1}
\DeclareFieldFormat{statutenickname}{\mkbibquote{#1\space\bibstring{act}}}
\DeclareFieldFormat{statutevolume}{#1}
\DeclareFieldFormat{statutejurisdiction}{\mkbibparens{#1}}
\DeclareFieldFormat{statuteregnalyear}{#1}
\DeclareFieldFormat{statutechapter}{#1}
\DeclareFieldFormat{statuteyear}{#1}
\DeclareFieldFormat{statutetitleyear}{\iftoggle{stattyitalic}{\mkbibemph{#1}}{#1}}

% fieldformats: ljarticle
%%author,
%%title,
\DeclareFieldFormat[ljarticle]{title}{\iftoggle{ljarttitleitalic}{\mkbibemph{#1}}{#1}}
\DeclareFieldFormat[ljarticle]{subtitle}{\iftoggle{ljarttitleitalic}{\mkbibemph{#1}}{#1}}
%%mncyear,
%%mncname,
%%mncnumber,
%%date,
%%volume,
%%journaltitle,
\DeclareFieldFormat[ljarticle]{journaltitle}{\iftoggle{ljjnltitleitalic}{\mkbibemph{#1}}{#1}}
%%pages,
%%keywords,
%%note,



% bibmacros: case

%=========== partysep
\newbibmacro{getpartysep}{%
\iffieldundef{partysep}{%
 \iftoggle{partysepitalic}%
  {\mkbibemph{\bibstring{versus}}}%
  {\bibstring{versus}}%
 \iftoggle{partysepdotted}{\adddot}{}%
 }%
 {%
 \printfield{partysep}
% \iftoggle{partysepitalic}%
%  {\mkbibemph{\printfield{partysep}}}%
%  {\printfield{partysep}}%
% \iftoggle{partysepdotted}{\adddot}{}%
 }%
}

%======= partynamesa
\newbibmacro{getpartynamesa}{%
\iffootnote{%
\iffieldundef{partyasn}{\printfield{partya}}{\printfield{partyasn}}}%
{\printfield{partya}}%
\iffieldundef{partyajur}{}{\addspace\printfield{partyajur}}%
}%

%======= partynamesb
\newbibmacro{getpartynamesb}{%
\iffootnote{%
\iffieldundef{partybsn}{\printfield{partyb}}{\printfield{partybsn}}}%
{\printfield{partyb}}%
\iffieldundef{partybjur}{}{\addspace\printfield{partybjur}}%
}%


%======= casename
\newbibmacro{getcasename}{%
%\ifciteseen{\ifciteibid{SEENIBID}{SEEN}}{}%
\iffootnote{%
\ifciteseen{\ifciteibid{\textcolor{red}{CC}}{\usebibmacro{getcaseshortname}\textcolor{red}{DD}}}{%
\iffieldundef{shipname}{\usebibmacro{getpartynamesa}%
\iffieldundef{partyb}{}%
{\addspace\usebibmacro{getpartysep}\addspace%
\usebibmacro{getpartynamesb}}%
}%no shipname
{The \printfield{shipname}}%
\iffieldundef{decisionyear}{}{\addspace\printfield{decisionyear}}%
%\newunit
%\newblock
}%not seen, not ibid
}%end in footnote
{%
\iffieldundef{shipname}{\usebibmacro{getpartynamesa}%
\iffieldundef{partyb}{}%
{\addspace\usebibmacro{getpartysep}\addspace%
\usebibmacro{getpartynamesb}}%
}%no shipname
{The \printfield{shipname}}%
\iffieldundef{decisionyear}{}{\addspace\printfield{decisionyear}}%
}%not in footnote
}%


%======= casenamefull
\newbibmacro{getcasenamefull}{%
\iffieldundef{shipname}{\usebibmacro{getpartynamesa}%
\iffieldundef{partyb}{}%
{\addspace\usebibmacro{getpartysep}\addspace%
\usebibmacro{getpartynamesb}}%
}%no shipname
{The \printfield{shipname}}%
\iffieldundef{decisionyear}{}{\addspace\printfield{decisionyear}}%
}%


%%%======= casename
%%\newbibmacro{getcasename}{%
%%\iffieldundef{shipname}{\printfield{partya}%
%%\iffieldundef{partyb}{}%
%%{\addspace\usebibmacro{getpartysep}\addspace%
%%\printfield{partyb}}%
%%}%no shipname
%%{The \printfield{shipname}}%
%%\iffieldundef{decisionyear}{}{\addspace\printfield{decisionyear}}%
%%\newunit
%%\newblock
%%}%

%======== casesn
\newbibmacro{getcasesn}{%
\iffieldundef{shipname}{\iffieldundef{partya}{}{\printfield{partya}}}%
{\printfield{shipname}}%
}


%======== caseshortname
\newbibmacro{getcaseshortname}{%
\iffieldundef{shipname}{\iffieldundef{caseshortname}{%
%if no caseshortname, use partya (if there is one)
\iffieldundef{partya}{}{\printfield{partya}}%
}{\printfield{caseshortname}}}%
{\printfield{shipname}}%
}



%======== casenickname
\newbibmacro{getcasenickname}{%
\iffieldundef{casenickname}{}{\printfield{casenickname}}%
}




%======== caseyear
\newbibmacro{getcaseyear}{%
\iffieldundef{caseyear}{}%
{\iffieldundef{mncurl}{\addspace\printfield{caseyear}}}%
{\printfield{caseyear}}%
}

%======== courtname
\newbibmacro{getcourtname}{%
\iffieldundef{courtname}{}%
{\addspace\printfield{courtname}}%
}

%======== casenumber
\newbibmacro{getcasenumber}{%
\iffieldundef{casenumber}{}%
{\addspace\printfield{casenumber}}%
}





%
\newbibmacro{getreportyear}{%
\ifkeyword{nobracketssecondref}%
{%no brackets
\iffieldundef{reportyear}%
{\iffieldundef{caseyear}%if no report year
{}%if no case year
{\iftoggle{caseyearasreportyear}{\printfield{caseyear}}{}}%
}%end if no reportyear
{\iffieldundef{volyearneeded}{%
\iffieldundef{reportvolume}{%
\printtext{\printfield{reportyear}}%
}{\printtext{\printfield{reportyear}}}%
}{%
\printtext{\printfield{reportyear}}%
%
}}%
}%end no brackets
{%use brackets
\iffieldundef{reportyear}%
{\iffieldundef{caseyear}%if no report year
{}%if no case year
{\iftoggle{caseyearasreportyear}{\printfield{caseyear}}{}}%
}%end if no reportyear
{\iffieldundef{volyearneeded}{%
\iffieldundef{reportvolume}{%
\printtext{\mkbibbrackets{\printfield{reportyear}}}%
}{\printtext{\mkbibparens{\printfield{reportyear}}}}%
}{%
\printtext{\mkbibbrackets{\printfield{reportyear}}}%
%
}}%
}%xx
}

%  reportvolume = {3},
%  volyearneeded = {true},


%
\newbibmacro{getreportvolume}{%
\iffieldundef{reportvolume}{}%
{%
\addspace\printfield{reportvolume}%
}}

%
\newbibmacro{getreportseries}{%
\addspace\printfield{reportseries}%
}

%
\newbibmacro{getreportpage}{%
\addspace\printfield{reportpage}%
}

%======== getreportref
\newbibmacro{getreportref}{%
%\iftoggle{scndrefbrackets}{scndrefbrackets}{}%
\iffieldundef{reportpage}{}%
{%
% \iffieldundef{casenumber}{}{\setunit*{\addcomma\addspace}}%
 \usebibmacro{getreportyear}%
 \usebibmacro{getreportvolume}%
 \usebibmacro{getreportseries}%
 \usebibmacro{getreportpage}%
 \setunit*{\addcomma\addspace}%
}}

%======== getnote
\newbibmacro{getnote}{%
\iffieldundef{note}
{}%
{%false
%print note if not ibid:
 \ifboolexpr{%
  test {\ifcitation}
  and
  test {\ifciteseen}
  and
  test {\ifciteibid}
  }%
	{}{%not an ibid
 \setunit*{\addspace}%
 \printtext[parens]{%
 \printfield{note}%
 }
}}}


%======= casexxx
\newbibmacro{casexxx}{%
xxx}%


%======== getcaseref
\newbibmacro{getcaseref}{%
	\iffieldundef{mncurl}{%
 \usebibmacro{getcaseyear}%
 \usebibmacro{getcourtname}%
 \usebibmacro{getcasenumber}%
 }{%
  \ifhyperref
    {%
    		\printtext{\addspace}%clear the puncuation buffer = no comma in link
    		\iffieldundef{casenumber}{%
				    \url{\thefield{mncurl}}
    				}%
    				{\href{\thefield{mncurl}}{%
								 \usebibmacro{getcaseyear}%
								 \usebibmacro{getcourtname}%
								 \usebibmacro{getcasenumber}%
    																					}}%
    }%
    {\nolinkurl{\thefield{mncurl}}}%
}%
 \usebibmacro{mnc:postnote}%
%
%   \newunit
%    \newblock
%  YYY
%\usebibmacro{postnote}
   \iffieldundef{reportpage}{}{\iffieldundef{casenumber}{}{\setunit*{\addcomma\addspace}}\usebibmacro{getreportref}}%
   \iffieldundef{parallel}{}{\setunit*{\addcomma\space}}%
%   \usebibmacro{getnote}%
%   \newunit
%   \newblock%
}

%======== getibid
\newbibmacro{getibid}{%
% text format
 \iftoggle{ibiditalic}%
  {\mkbibemph{\iftoggle{ibiduppercase}{\MakeCapital{\bibstring{ibid}}}{\bibstring{ibid}}}}%
  {\iftoggle{ibiduppercase}{\MakeCapital{\bibstring{ibid}}}{\bibstring{ibid}}}%
% if postnote different:
% delimiter
 \ifcase\theibiddelimmode \or%none
 \or%
% \textcolor{red}{CC}%
 \addcomma%
% \textcolor{red}{DD}%
 \or\addcolon%
 \or\adddot%
	\fi
%
%\addspace
}


\newtoggle{lcibidtracking}
\toggletrue{lcibidtracking}


\newtoggle{supranoteused}
\togglefalse{supranoteused}

\newbibmacro{getibidsupra}{%
		  \iftoggle{ibidsupraon}{%
%		  supra
		  \iftoggle{ibidsupraitalic}{%
			%		  italic
					  \mkbibemph{\bibstring{ibidsupra}}}%
					  {\bibstring{ibidsupra}}%
					  \addspace%
			}
			{		  \iftoggle{ibidsupraitalic}{%
			%		  italic
					  \mkbibemph{\bibstring{ibidsupra}}}%
					  {\bibstring{ibidsupra}}%
}%
}
%=========== getibidsupranote: 5 settings
\newbibmacro{getibidsupranote}{%
%,
%\togglefalse{supranoteused}
%\textcolor{red}{AA}%
\iftoggle{ibidsupracomma}{\addcomma}{}%
%\textcolor{red}{BB}%
%
 \addspace 
%()
 \iftoggle{ibidsuprabrackets}{%
  \mkbibparens{%
		  \iftoggle{ibidsupraon}{\usebibmacro{getibidsupra}}{}%
%		  note
		  \iftoggle{ibidsupranotelong}{\bibstring{ibidsupranote}}%
		  {\bibstring{ibidsupran}}%
				\addspace\ref{cfn:\thefield{entrykey}}%
				\toggletrue{supranoteused}%
		  }%parens
		  }%
			{%
			\iftoggle{ibidsupraon}{\usebibmacro{getibidsupra}}{}%
%		  note
		  \iftoggle{ibidsupranotelong}{\bibstring{ibidsupranote}}%
		  {\bibstring{ibidsupran}}%
				\addspace\ref{cfn:\thefield{entrykey}}%
				\toggletrue{supranoteused}%
				}%no parens
%%%  no ()
%%  {\iftoggle{ibidsupraon}{%
%%  \iftoggle{ibidsupraitalic}{%
%%  \mkbibemph{\iftoggle{ibidsupranotelong}{%
%%  \bibstring{ibidsupranote}}{\bibstring{ibidsupran}}}}{\iftoggle{ibidsupranotelong}{%
%%  \bibstring{ibidsupranote}}{\bibstring{ibidsupran}}}}{} \ref{cfn:\thefield{entrykey}}}%
%  
%===  
%  \addcomma\addspace\mkbibemph{\bibstring{ibidsupra}} \bibstring{ibidsupranote} \ref{cfn:\thefield{entrykey}}%
}


%====================================== toggle commands
%\newcommand\lcnamerefdelim{\addcomma\addspace}
\newcommand\lcnamerefdelim{\addspace}
\newcommand\lcnamerefcommadelim{\addcomma\addspace}
\newcommand\lcparentchilddelim{\addcomma}

\newcommand\setcasenamecommaon{\toggletrue{casenamecomma}}
\newcommand\setcasenamecommaoff{\togglefalse{casenamecomma}}

\newcommand\setpartysepitalicon{\settoggle{partysepitalic}{true}}
\newcommand\setpartysepitalicoff{\settoggle{partysepitalic}{false}}

\newcommand\setpartysepdottedon{\settoggle{partysepdotted}{true}}
\newcommand\setpartysepdottedoff{\settoggle{partysepdotted}{false}}


\newcommand\setpartynamesitalicon{\settoggle{partynamesitalic}{true}}
\newcommand\setpartynamesitalicoff{\settoggle{partynamesitalic}{false}}

\newcommand\lcconstallabove{1}
\newcommand\lcconstabovebelow{2}
\newcommand\lcconstallbelow{3}
\newcommand\lcconsttitleonly{4}

\newcommand\setallabove{\setcounter{reftypemode}{\lcconstallabove}}
\newcommand\setabovebelow{\setcounter{reftypemode}{\lcconstabovebelow}}
\newcommand\setallbelow{\setcounter{reftypemode}{\lcconstallbelow}}
\newcommand\settitleonly{\setcounter{reftypemode}{\lcconsttitleonly}}




\newcommand\setmncbracketson{\settoggle{mncbrackets}{true}}
\newcommand\setmncbracketsoff{\settoggle{mncbrackets}{false}}


\newcommand\setprintlegtocon{\settoggle{printlegtoc}{true}}
\newcommand\setprintlegtocoff{\settoggle{printlegtoc}{false}}


\newcommand\setrefintocon{\settoggle{refintoc}{true}}
\newcommand\setrefintocoff{\settoggle{refintoc}{false}}

\newcommand\setstatjurison{\settoggle{statjurisdiction}{true}}
\newcommand\setstatjurisoff{\settoggle{statjurisdiction}{false}}

\newcommand\setmulticitecommaon{\toggletrue{multicitecomma}}
\newcommand\setmulticitecommaoff{\togglefalse{multicitecomma}}

\newcommand\lcsetdemoon{%
\setlcinlinecolour{red}
\setlcinlinerrcolour{brown}
\setlcinlinerrcoloursc{blue}
}
\newcommand\lcsetdemooff{%
\setlcinlinecolour{black}
\setlcinlinerrcolour{black}
\setlcinlinerrcoloursc{black}
}


%vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv

%===== casenamereffull
\newbibmacro{getcasenamereffull}{%
 \usebibmacro{getcasenamefull}%
 \ifboolexpr{%
  not test {\iffieldundef{casenumber}}
  or
  not test {\iffieldundef{reportpage}}
  }%
% {\iftoggle{casenamecomma}{\lcnamerefcommadelim}{\lcnamerefdelim}}%
% {\lcparentchilddelim}%
 {\iftoggle{casenamecomma}{\setunit*{\addcomma\addspace}}{\setunit*{\addspace}}}%true
 {\setunit*{\addspace}}%false
 \usebibmacro{getcaseref}%
 \usebibmacro{getparallelreports}%
% \usebibmacro{getnote}%
%    \finentry
 }
	 


%===== casenamerefnofn: no footnote  (i.e., no ibiding)
\newbibmacro{getcasenamerefnofn}{%
 \usebibmacro{getcasename}%
 \ifboolexpr{%
  not test {\iffieldundef{casenumber}}
  or
  not test {\iffieldundef{reportpage}}
  }%
% {\iftoggle{casenamecomma}{\lcnamerefcommadelim}{\lcnamerefdelim}}%
% {\lcparentchilddelim}%
 {\iftoggle{casenamecomma}{\setunit*{\addcomma\addspace}}{\setunit*{\addspace}}}%true
 {\setunit*{\addspace}}%false
 \usebibmacro{getcaseref}%
 \usebibmacro{getparallelreports}%
% \usebibmacro{getnote}%
%    \finentry
 }
	 

\newtoggle{usedibid}
\togglefalse{usedibid}



\newcommand{\itemlabelset}[3]{%key+labeltag: if cs exists,, label has been created
%\expandafter\newcommand\csname #1#2\endcsname{#1#2#3}%
\global\csdef{#1#2}{#1#2#3}%
}




%===== casenameref
\newbibmacro{getcasenameref}{%
 \togglefalse{usedibid}%
 \togglefalse{supranoteused}%
 \ifboolexpr{%
 not test {\iffootnote}
% or
% test {\iftoggle{lcibidtracking}}
 }%
 {\usebibmacro{getcasenamerefnofn}}{%if it is a footnote
 \ifboolexpr{%
  test {\ifcitation}
  and
  test {\ifciteibid}
%  and
%  test {\iftoggle{lcibidtracking}}
  }%
  {%
%  \iftoggle{lcibidtracking}{%we're in a command that wants ibid:
  \toggletrue{usedibid}%
  \usebibmacro{getibid}%
%  }{}%
%  \textcolor{red}{AA}%
%%if current postnote = previous postnote, then nothing; else:
%%%\ifdefstrequal{\ibidprevpintemp}{\thefield{postnote}}%
%%%{}%do nothing extra
%%%{%otherwise:
\ifloccit{}%end loccit true
  {%start loccit false
  \iftoggle{ibidpostdelimcomma}%
  {\DeclareDelimFormat{postnotedelim}{\addcomma\space}}%
  {\DeclareDelimFormat{postnotedelim}{\space}}%
%	\textcolor{red}{BB}%
  \usebibmacro{postnote}%actual ibid
%%%  \textcolor{red}{xx\ibidprevpintemp}%
  \DeclareDelimFormat{postnotedelim}{\addcomma\space}%restore
}%end loccit false
%%%  \renewcommand{\ibidprevpintemp}{\thefield{postnote}}%
%%%}%
%  \textcolor{red}{BB}%
  }{%
 \ifboolexpr{%
  test {\ifcitation}
  and
  test {\ifciteseen}
  and
  not test {\ifciteibid}
  and
  test {\ifcsdef{\thefield{entrykey}label}}
  }%
  {%\textcolor{red}{AA}%
  %if no shortname, use full name
%%  \iffieldundef{caseshortname}{%start no shortname
%%  \usebibmacro{getcasename}}{%
\usebibmacro{getcaseshortname}
%%}%end no shortname
%  \addspace\mkbibparens{n \ref{cfn:\thefield{entrykey}}%
%  }%
%  \addcomma\addspace\mkbibemph{supra} note \ref{cfn:\thefield{entrykey}}%
  \usebibmacro{getibidsupranote}\toggletrue{supranoteused}%
%  \textcolor{red}{AA}%
  \iftoggle{ibidpostdelimcomma}%
  {\DeclareDelimFormat{postnotedelim}{\addcomma\space}}%
  {\DeclareDelimFormat{postnotedelim}{\space}}%
  \usebibmacro{postnote}%
%  \textcolor{red}{BB}%
  \DeclareDelimFormat{postnotedelim}{\addcomma\space}%restore
  %
  }{%
 \usebibmacro{getcasename}%
% \iftoggle{casenamecomma}{\setunit*{\addcomma\addspace}}{\setunit*{\addspace}}%
 \ifboolexpr{%
  not test {\iffieldundef{casenumber}}
  or
  not test {\iffieldundef{reportpage}}
  }%
% {\iftoggle{casenamecomma}{\lcnamerefcommadelim}{\lcnamerefdelim}}%
% {\lcparentchilddelim}%
 {\iftoggle{casenamecomma}{\setunit*{\addcomma\addspace}}{\setunit*{\addspace}}}%true
 {\setunit*{\addspace}}%false
%%\iffieldundef{mncurl}{\usebibmacro{getcaseref}}{\addspace\printtext[angles]{\usebibmacro{getcaseref}}}%
	\iffieldundef{casenumber}{}{\addcomma}%
 \usebibmacro{getcaseref}%
 \usebibmacro{getparallelreports}%
\iffieldundef{url}{}{\addspace\printtext[angles]{\usebibmacro{getcaseurl}}}% 
% \usebibmacro{getnote}%
%    \finentry
 }}%ifciteibid false
 % label
%% \ifcsdef{\thefield{entrykey}label}{\textcolor{red}{XX}}{}%
% \csname\thefield{entrykey}label\endcsname%
%% \thefield{entrykey}label%
 \ifboolexpr{%
  test {\ifcitation}
%  and
%  not test {\ifciteseen}
  and
  not test {\ifciteibid}
  and
  test {\iffootnote}
  and
  not test {\ifcsdef{\thefield{entrykey}label}}
  }%
	{\label{cfn:\thefield{entrykey}}%
	\itemlabelset{\thefield{entrykey}}{label}{\thefootnote}%tracking
%	\textcolor{red}{AA}%
	}{}%
% \ifboolexpr{%
%  test {\iffootnote}
%  and
%  not test {\ifcsdef{\thefield{entrykey}label}}
%  }%
%	{\label{cfn:\thefield{entrykey}}%
%	\itemlabelset{\thefield{entrykey}}{label}{\thefootnote}%
%	>>\textcolor{red}{AA\csname \thefield{entrykey}label\endcsname}<<%
%	}{}%
}}


%bibmacros: statute  ========================
\newbibmacro{getstatutetitle}{%
\iffieldundef{statutetitle}{}%
{\printfield{statutetitle}{%
 \iffieldundef{statutetitleyear}{}{%
  \iftoggle{stattycomma}{\addcomma\addspace}{\addspace}%
  \usebibmacro{getstatutetitleyear}%
  }%
 }%
}%
}


\newbibmacro{getstatutelongtitle}{%
\iffieldundef{statutelongtitle}{}%
{\printfield{statutelongtitle}}%
}


\newbibmacro{getstatuteshorttitle}{%
\iffieldundef{statuteshorttitle}{}%
{\printfield{statuteshorttitle}}%
}


\newbibmacro{getstatutenickname}{%
\iffieldundef{statutenickname}{}%
{\printfield{statutenickname}}%
}


\newbibmacro{getstatutevolume}{%
\iffieldundef{statutevolume}{}%
{\printfield{statutevolume}}%
}


\newbibmacro{getstatutejurisdiction}{%
\iffieldundef{statutejurisdiction}{}%
{\statutejurisdictiondelim\printfield{statutejurisdiction}}%
}


\newbibmacro{getstatuteregnalyear}{%
\iffieldundef{statuteregnalyear}{}%
{\printfield{statuteregnalyear}}%
}


\newbibmacro{getstatutechapter}{%
\iffieldundef{statutechapter}{}%
{\printfield{statutechapter}}%
}


\newbibmacro{getstatuteyear}{%
\iffieldundef{statuteyear}{}%
{\printfield{statuteyear}}%
}


\newbibmacro{getstatutetitleyear}{%
\iffieldundef{statutetitleyear}{}%
{\printfield{statutetitleyear}}%
}

%\ifboolexpr{%
%test {\ifentrytype{statute}}%
%}%
%{\sindex[legislation]{\thefield{statutetitle} \thefield{statutetitleyear}}}%
%{}%

%======================= statutename
\newbibmacro{getstatutename}{%
 \usebibmacro{getstatutetitle}%
% \iffieldundef{statutetitleyear}{%
%  \iffieldundef{statuteyear}{}%
%  {\addcomma\addspace\usebibmacro{getstatuteyear}
%  }%
% }%
% {\statutetitleyeardelim\usebibmacro{getstatutetitleyear}}%
 \iftoggle{statjurisdiction}{\usebibmacro{getstatutejurisdiction}}{}%
}


%======================= statuteref
\newbibmacro{getstatuteref}{%
{}%
}

%======================= statutenameref
\newbibmacro{getstatutenameref}{%
 \usebibmacro{getstatutename}%
 \usebibmacro{getstatuteref}%
}

\expandafter\newbibmacro{\csname lc/aglc/can/delleg/revfedreg/1\endcsname}{%
\printfield{statutetitle}\addcomma\addspace\printfield{statuteshorttitle}%
\addcomma\addspace\bibstring{canchapter}\addspace\printfield{statutechapter}
%sindex{} not coded here
}%

%======================= canreg
\newbibmacro{getcanreg}{%
 \usebibmacro{\csname lc/aglc/can/delleg/revfedreg/1\endcsname}%
}





%======================= canleg
\newbibmacro{getcanleg}{%
%----
\iffieldequalstr{citeref}{canleg}{%
 \printfield{title}\addcomma\addspace\printfield{svjy}%
\addcomma\addspace\bibstring{canchapter}\addspace\thefield{chapter}%
\renewcommand\lcindexaccum{}%empty
\xappto\lcindexaccum{%
\thefield{title}, \thefield{svjy}%
, c \thefield{chapter}%
}%
\ifkeyword{regulations}{\toggletrue{printxregulations}}{\togglefalse{printxregulations}}%
\iftoggle{lcindexing}{\sindex[\lctor]{\lcindexaccum\lcparnumrefsencap}}{}%
\togglefalse{printxregulations}%
\renewcommand\lcindexaccum{}%empty
 }{}%endif
}

%%%\ifkeyword{regulations}{\iftoggle{printregulations}{regulations}{legislation}}{legislation}
% \ifkeyword upsets sindex[] (timing of the loop?), but \iftoggle is OK.






%=============== cs helpers for citeref
\newcommand\lcregstring{Reg}
\newcommand\lcforwardslash{/}
\newcommand\lchyphen{-}

%num/year:
%\newcommand\altaregabbrevdiv{\lcforwardslash}
\newcommand\altaregabbrevjur{Alta}
\newcommand\altaregabbrevreg{\lcregstring}
\newcommand\bcregabbrevjur{BC}
\newcommand\bcregabbrevreg{\lcregstring}
\newcommand\manregabbrevjur{Man}
\newcommand\manregabbrevreg{\lcregstring}
\newcommand\nfldregabbrevjur{Nfld}
\newcommand\nfldregabbrevreg{\lcregstring}
\newcommand\nlrregabbrevjur{NLR}
\newcommand\nlrregabbrevreg{\lcregstring}
\newcommand\nsregabbrevjur{NS}
\newcommand\nsregabbrevreg{\lcregstring}
\newcommand\nwtregabbrevjur{NWT}
\newcommand\nwtregabbrevreg{\lcregstring}
\newcommand\oregabbrevjur{O}
\newcommand\oregabbrevreg{\lcregstring}
\newcommand\saskregabbrevjur{Sask}
\newcommand\saskregabbrevreg{\lcregstring}

%year/num
\newcommand\nbregabbrevjur{NB}
\newcommand\nbregabbrevreg{\lcregstring}
\newcommand\nuregabbrevjur{Nu}
\newcommand\nuregabbrevreg{\lcregstring}
\newcommand\peiregabbrevjur{PEI}
\newcommand\peiregabbrevreg{\lcregstring\ EC}
\newcommand\yoicregabbrevjur{YOIC}
\newcommand\yoicregabbrevreg{\lcregstring}


%bibmacros can take parameters

%Create the regulation's formatted definition: regnum-year:
\newbibmacro{make-reg-num-year-format}[2]{%1=abbrev, 2=num/year delimiter
%#1xxx#2%
%title
\csxdef{#1regfielddelim1}{\addcomma\addspace}%
\csxdef{#1regfield1}{\iffieldundef{title}{}{\printfield{title}\csuse{#1regfielddelim1}}}%
%jurisdiction
\csxdef{#1regfielddelim2}{\addspace}%
\csxdef{#1regfield2}{\csuse{#1regabbrevjur}\csuse{#1regfielddelim2}}%
%regulation label
\csxdef{#1regfielddelim3}{\addspace}%
\csxdef{#1regfield3}{\csuse{#1regabbrevreg}\csuse{#1regfielddelim3}}%
%regulation's format: num-div-...:
\csxdef{#1regabbrevdiv}{#2}%
\csxdef{#1regfielddelim4}{\csuse{#1regabbrevdiv}}%
\csxdef{#1regfield4}{\printfield{regnum}\csuse{#1regfielddelim4}}%
%regulation's format: ...-year:
\csxdef{#1regfielddelim5}{}%
\csxdef{#1regfield5}{\printfield{year}\csuse{#1regfielddelim5}}%
%assembled:
\csxdef{#1reg}{\csuse{#1regfield1}\csuse{#1regfield2}\csuse{#1regfield3}\csuse{#1regfield4}\csuse{#1regfield5}}%
}

%
\newbibmacro{use-regnum-year}[2]{%1=jurisdiction tag, 2=reg-year divider
 \usebibmacro{make-reg-num-year-format}{#1}{#2}%
   \csuse{#1reg}%
}

%---------------
%Create the regulation's formatted definition: year-regnum:
\newbibmacro{make-year-reg-num-format}[2]{%1=abbrev, 2=year/num delimiter
%#1xxx#2%
%title
\csxdef{#1regfielddelim1}{\addcomma\addspace}%
\csxdef{#1regfield1}{\iffieldundef{title}{}{\printfield{title}\csuse{#1regfielddelim1}}}%
%jurisdiction
\csxdef{#1regfielddelim2}{\addspace}%
\csxdef{#1regfield2}{\csuse{#1regabbrevjur}\csuse{#1regfielddelim2}}%
%regulation label
\csxdef{#1regfielddelim3}{\addspace}%
\csxdef{#1regfield3}{\csuse{#1regabbrevreg}\csuse{#1regfielddelim3}}%
%regulation's format: year-div-...:
\csxdef{#1regabbrevdiv}{#2}%
\csxdef{#1regfielddelim4}{\csuse{#1regabbrevdiv}}%
\csxdef{#1regfield4}{\printfield{year}\csuse{#1regfielddelim4}}%
%regulation's format: ...-num:
\csxdef{#1regfielddelim5}{}%
\csxdef{#1regfield5}{\printfield{regnum}\csuse{#1regfielddelim5}}%
%assembled:
\csxdef{#1reg}{\csuse{#1regfield1}\csuse{#1regfield2}\csuse{#1regfield3}\csuse{#1regfield4}\csuse{#1regfield5}}%
}

%
\newbibmacro{use-year-regnum}[2]{%1=jurisdiction tag, 2=reg-year divider
 \usebibmacro{make-year-reg-num-format}{#1}{#2}%
   \csuse{#1reg}%
}

\newbibmacro{use-verbreg}{%
 \printtext{\thefield{regnum}}%
}





%-------------- can-alta-reg
\newbibmacro{can-alta-reg}{%
\csxdef{altaregfielddelim1}{\addcomma\addspace}%
\csxdef{altaregfield1}{\iffieldundef{title}{}{\printfield{title}\csuse{\altaregfielddelim1}}}%
\csxdef{altaregfielddelim2}{\addspace}%
\csxdef{altaregfield2}{\altaregabbrevjur\csuse{altaregfielddelim2}}%
\csxdef{altaregfielddelim3}{\addspace}%
\csxdef{altaregfield3}{\altaregabbrevreg\csuse{altaregfielddelim3}}%
\csxdef{altaregfielddelim4}{\altaregabbrevdiv}%
%regulation's format:
\csxdef{altaregfield4}{\printfield{regnum}\csuse{altaregfielddelim4}}%
\csxdef{altaregfielddelim5}{}%
\csxdef{altaregfield5}{\printfield{year}\csuse{altaregfielddelim5}}%
\csxdef{altareg}{\csuse{altaregfield1}\csuse{altaregfield2}\csuse{altaregfield3}\csuse{altaregfield4}\csuse{altaregfield5}}%
\csuse{altareg}%
\usebibmacro{make-reg-num-year-format}{A}{B}
}







%======================= canreg2
\newbibmacro{getcanreg2}{%
%----
\iffieldequalstr{citeref}{crcreg}{%
 \printfield{title}\addcomma\addspace CRC%
\addcomma\addspace\bibstring{canchapter}\addspace\thefield{chapter}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\thefield{title}, CRC, c \thefield{chapter}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{sorreg}{%
 \printfield{title}\addcomma\addspace SOR%
/\printfield{year}-\printfield{regnum}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\thefield{title}, SOR/\thefield{year}-\thefield{regnum}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{altareg}{%
 \usebibmacro{use-regnum-year}{alta}{\lcforwardslash}%
% \usebibmacro{can-alta-reg}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% Alta Reg%
%\addspace\printfield{regnum}/\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }Alta Reg \thefield{regnum}/\thefield{year}\lcparnumrefsencap}}{} %
 }{}%endif
%----
\iffieldequalstr{citeref}{bcreg}{%
 \usebibmacro{use-regnum-year}{bc}{\lcforwardslash}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% BC Reg%
%\addspace\printfield{regnum}/\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }BC Reg \thefield{regnum}/\thefield{year}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{manreg}{%
 \usebibmacro{use-regnum-year}{man}{\lcforwardslash}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% Man Reg%
%\addspace\printfield{regnum}/\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }Man Reg \thefield{regnum}/\thefield{year}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{nbreg}{%
 \usebibmacro{use-year-regnum}{nb}{\lchyphen}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% NB Reg%
%\addspace\printfield{year}-\printfield{regnum}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }NB Reg \thefield{year}-\thefield{regnum}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{nfldreg}{%
 \usebibmacro{use-regnum-year}{nfld}{\lcforwardslash}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% Nfld Reg%
%\addspace\printfield{regnum}/\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }Nfld \thefield{regnum}/\thefield{year}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{nlrreg}{%
 \usebibmacro{use-regnum-year}{nlr}{\lcforwardslash}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% NLR%
%\addspace\printfield{regnum}/\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }NLR \thefield{regnum}/\thefield{year}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{nwtreg}{%
 \usebibmacro{use-regnum-year}{nwt}{\lchyphen}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% NWT Reg%
%\addspace\printfield{regnum}-\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }NWT Reg \thefield{regnum}-\thefield{year}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{nsreg}{%
 \usebibmacro{use-regnum-year}{ns}{\lcforwardslash}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% NS Reg%
%\addspace\printfield{regnum}/\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }NS Reg \thefield{regnum}/\thefield{year}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{nureg}{%
 \usebibmacro{use-year-regnum}{nu}{\lchyphen}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% Nu Reg%
%\addspace\printfield{regnum}-\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }Nu Reg \thefield{regnum}-\thefield{year}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{oreg}{%
 \usebibmacro{use-regnum-year}{o}{\lcforwardslash}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% O Reg%
%\addspace\printfield{regnum}/\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }O Reg \thefield{regnum}/\thefield{year}\lcparnumrefsencap}}{} %
 }{}%endif
%----
\iffieldequalstr{citeref}{peireg}{%
 \usebibmacro{use-year-regnum}{pei}{\lchyphen}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% PEI Reg%
%\addspace EC\printfield{year}-\printfield{regnum}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }PEI Reg \thefield{year}-\thefield{regnum}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{ocreg}{%
   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
 OC%
\addspace\printfield{regnum}-\printfield{year}%
\addcomma\addspace\printfield{fulldate}%
\addcomma\addspace GOQ\addspace\printfield{gazette}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }OC Reg \thefield{regnum}-\thefield{year}%
 , \thefield{fulldate}, GOQ \thefield{gazette}%
\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{saskreg}{%
 \usebibmacro{use-regnum-year}{sask}{\lcforwardslash}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% Sask Reg%
%\addspace\printfield{regnum}/\printfield{year}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }Sask Reg \thefield{regnum}/\thefield{year}\lcparnumrefsencap}}{}%
 }{}%endif
%----
\iffieldequalstr{citeref}{yoicreg}{%
 \usebibmacro{use-year-regnum}{yoic}{\lcforwardslash}%
%   \iffieldundef{title}{}{\printfield{title}\addcomma\addspace}%
% YOIC Reg%
%\addspace\printfield{year}/\printfield{regnum}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }YOIC Reg \thefield{year}/\thefield{regnum}\lcparnumrefsencap}}{}%
 }{}%endif
%----user-defined
\iffieldequalstr{citeref}{verbreg}{%
 \usebibmacro{use-verbreg}%
\iftoggle{lcindexing}{%
 \sindex[\iftoggle{printregulations}{regulations}{legislation}]{\iffieldundef{title}{}{\thefield{title}, }\thefield{regnum}\lcparnumrefsencap}}{}%
 }{}%endif
}


%\newbibmacro{assigncaseprenote}{%
% \ifcase\thereftypemode \or%
% \usebibmacro{prenote}%inline
% \or% prenote goes in the footnote for this variation, along with the case ref.
% \or% prenote is already in the footnote
% \fi%
%}

%\newbibmacro{assigncasepostnote}{%
% \ifcase\thereftypemode \or%
% \usebibmacro{postnote}% inline
% \or% postnote is already in the footnote
% \or% postnote is already in the footnote
% \fi%
%}


%\newbibmacro{assigncaseitem}{%
% \ifcase\thereftypemode%
% \or\usebibmacro{getcasenameref}%
% \or\usebibmacro{getcasename}\footnote{\usebibmacro{prenote}\usebibmacro{getcaseref}\usebibmacro{postnote}}%
% \or\unspace\footnote{\usebibmacro{prenote}\usebibmacro{getcasenameref}\usebibmacro{postnote}}%
% \fi%
%}


%% \ifboolexpr{%
%% test {\ifentrytype{@case}}%
%% }%
%% {%
%% \usebibmacro{assigncaseitem}
%% }%
%% {%
%%%%%%%  \autocite[\usebibmacro{prenote}][\usebibmacro{postnote}]{#1}%
%% }%






%%%======================= label the footnote
%%\newbibmacro{setfnlabel}{%
%%%%\iffootnote
%%%%    {%
%%%%%    \ifciteseen{xseenx}{\printtext{\thefield{entrykey}}\protect\label{f\thefield{entrykey}}}%
%%    \ifnumequal{\value{citecounter}}{1}{xfirstx}{\thecitecounter yyotheryy\protect\label{f\thefield{entrykey}}}
%%%%     }%
%%%%    {}%
%%}

%%%\iffootnote
%%%    {%
%%%    \ifciteseen{}{\csxdef{f\thefield{entrykey}}{\the\value{instcount}}%
%%%%     \label{f\the\value{instcount}}}%
%%%     \label{f\thefield{entrykey}}}%
%%%     }
%%%    {}%
%%%}




%==================

%index accumulator for related reports
\newcommand\lcindexaccum{}



%\sindex[legislation]{\thefield{statutetitle} \thefield{statutetitleyear}}%


\newbibmacro{mnc:postnote}{%
 \ifboolexpr{%
  not test {\iffieldundef{casenumber}}%if there is MNC
  and
  test {\iftoggle{pinpointaftermnc}}%and pinpoint after MNC
  }%
 % print the postnote after the MNC
 {\usebibmacro{postnote}}%
 % otherwise don't print anything after the MNC postion
 {}%
}


\newbibmacro{notmnc:postnote}{%
  \ifboolexpr{%
%  test {\ifcitation}
%  and
%  test {\ifciteibid}
%  and
%  test {\ifciteseen}
%  and
%  test {\iffootnote}
		test {\iftoggle{usedibid}}
  }%
				{}% ibid tracker works perfectly
				{%
 \ifboolexpr{%
  not test {\iffieldundef{casenumber}}%if there is MNC
  and
  test {\iftoggle{pinpointaftermnc}}%and pinpoint after MNC
  }%
%  don't print anything in the postnote position
 {}%
 % otherwise print the postnote in the postnote postion
% if it is not an ibid/supra note reference
 {%
\iftoggle{supranoteused}{}{%
%\textcolor{red}{CC}%
%	\printfield[emph]{postnote}%
			\usebibmacro{postnote}%
%			\textcolor{red}{DD}%
			}%
				}%
 }%
}

\newbibmacro*{nocomma:postnote}{%
  \iffieldundef{postnote}
    {}
    {\setunit{\printdelim{postnotedelim}}%
     \printfield{postnote}}}


\ExplSyntaxOn

\tl_new:N \l_myscriptname_tl
\NewDocumentCommand\getblcommand { m }
{
	\tl_set:Nx \l_myscriptname_tl { #1 }

	\regex_replace_all:nnN 
							{ given\-family	 } 
							{ 
										\c{DeclareNameAlias} [book]
										\cB\{ author\cE\}
										\cB\{ given-family \cE\}
							} 
							\l_myscriptname_tl
	

	\regex_replace_all:nnN 
							{ itcolon } 
							{ 
										\c{textit} \cB\{ \c{addcolon} \cE\}
							} 
							\l_myscriptname_tl

	\regex_replace_all:nnN 
							{ isubtitle } 
							{ 
										isubxxx
							} 
							\l_myscriptname_tl

	
	\regex_replace_all:nnN 
							{ subtitle } 
							{ 
										subxxx
							} 
							\l_myscriptname_tl

	
	\regex_replace_all:nnN 
							{ dot } 
							{ 
										\c{adddot}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ comma } 
							{ 
										\c{addcomma}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ colon } 
							{ 
										\c{addcolon}
							} 
							\l_myscriptname_tl

	\regex_replace_all:nnN 
							{ space } 
							{ 
										\c{addspace}
							} 
							\l_myscriptname_tl

	\regex_replace_all:nnN 
							{ lparen } 
							{ 
										(
							} 
							\l_myscriptname_tl

	\regex_replace_all:nnN 
							{ rparen } 
							{ 
										)
							} 
							\l_myscriptname_tl

	\regex_replace_all:nnN 
							{ lbrace } 
							{ 
										\{
							} 
							\l_myscriptname_tl

	\regex_replace_all:nnN 
							{ rbrace } 
							{ 
										\}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ name } 
							{ 
										\c{printnames} \cB\{ author \cE\}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ title } 
							{ 
										\c{printfield} \cB\{ title \cE\}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ edition } 
							{ 
										\c{printfield} \cB\{ edition \cE\}
							} 
							\l_myscriptname_tl

	\regex_replace_all:nnN 
							{ location } 
							{ 
										\c{printlist} \cB\{ location \cE\}
							} 
							\l_myscriptname_tl

	\regex_replace_all:nnN 
							{ publisher } 
							{ 
										\c{printlist} \cB\{ publisher \cE\}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ year } 
							{ 
										\c{thefield} \cB\{ year \cE\}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ volume } 
							{ 
										\c{printfield} \cB\{ volume \cE\}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ note } 
							{ 
										\c{thefield} \cB\{ note \cE\}
							} 
							\l_myscriptname_tl
							

	\regex_replace_all:nnN 
							{ isubxxx } 
							{ 
										\c{printfield} [emph] \cB\{ subtitle \cE\}
							} 
							\l_myscriptname_tl
							
	\regex_replace_all:nnN 
							{ subxxx } 
							{ 
										\c{printfield} \cB\{ subtitle \cE\}
							} 
							\l_myscriptname_tl
							
							
		\tl_use:N \l_myscriptname_tl
}

\ExplSyntaxOff

\newcommand*{\lcsetseq}[1]{%
x#1;;
\ifstrequal{#1}{dot}{\adddot}{}
\ifstrequal{#1}{comma}{\addcomma}{}
\ifstrequal{#1}{colon}{\addcolon}{}
\ifstrequal{#1}{space}{\addspace}{}
\ifstrequal{#1}{lparen}{\{}{}
\ifstrequal{#1}{rparen}{\}}{}
\ifstrequal{#1}{name}{\printnames{author}}{}
\ifstrequal{#1}{title}{\printfield{title}}{}
\ifstrequal{#1}{location}{\printlist{location}}{}
\ifstrequal{#1}{publisher}{\printfield{publisher}}{}
}%



\DeclareCiteCommand{qcitetextnoqq}%
{\usebibmacro{prenote}}%
{%
\printfield[plain]{quotetext}%
}%
{}%
{\usebibmacro{postnote}}%


\DeclareCiteCommand{qcitetext}%
{\usebibmacro{prenote}}%
{%
\printfield{quotetext}%
}%
{}%
{\usebibmacro{postnote}}%




\DeclareCiteCommand{qcite}%
{\usebibmacro{prenote}}%
{%
\printfield{quotetext}%
\addspace\textemdash\addspace{%
\DeclareNameAlias[quote]{author}{given-family}%
\printnames{author}%
}%
%\printnames{editor}%
\addcomma\addspace\printfield{title}%
}%
{%
\multicitedelim%
}%
{\iffieldundef{postnote}{}{\addcomma\addspace\usebibmacro{postnote}\adddot}}


\newcommand\qqcitecasewidth{0.48}

\newbibmacro{qqcitebox}{%
\hfill\parbox{\iffieldundef{partya}{0.4}{\qqcitecasewidth}\textwidth}{\raggedright%
\printfield{quotetext}\par%
\smallskip\hrule\par%
\medskip{%
\DeclareNameAlias[quote]{author}{given-family}%
\iffieldundef{partya}{\hfill}{}\textemdash\addspace\printnames{author}%
}\ifnameundef{author}{}{\par}%
%\printnames{editor}%
\printfield{title}%if there is one
\iffieldundef{partya}{}{{\small\usebibmacro{getcasenameref}}}%if it's a case
\iffieldundef{casestatus}{}{\printtext{\addcomma\addspace\printfield{casestatus}}}%
\iffieldundef{courtfullname}{}{\printtext{\addcomma\addspace\printfield{courtfullname}}}%
\iffieldundef{postnote}{}{%
\iffieldundef{partya}{%
\addcomma\addspace\usebibmacro{postnote}}{}%
\adddot}%
}%end parbox
}


%formatted epigraph quote:
\DeclareCiteCommand{qqcite}%
{\usebibmacro{prenote}}%
{%
\usebibmacro{qqcitebox}%
}%
{%
%\multicitedelim%
}%
{}




%formatted epigraph quote: with footnote mark
\DeclareCiteCommand{qqcitefn}%
{\usebibmacro{prenote}}%
{%
\hfill\parbox{\iffieldundef{partya}{0.4}{\qqcitecasewidth}\textwidth}{\raggedright%
\printfield{quotetext}\par%
\smallskip\hrule\par%
\medskip{%
\DeclareNameAlias[quote]{author}{given-family}%
\iffieldundef{partya}{\hfill}{}\textemdash\addspace\printnames{author}%
}\iffieldundef{author}{}{\par}%
%\printnames{editor}%
\printfield{title}%if there is one
\iffieldundef{partya}{}{{\small\usebibmacro{getcasenameref}}}%if it's a case
\iffieldundef{casestatus}{}{\printtext{\addcomma\addspace\printfield{casestatus}}}%
\iffieldundef{courtfullname}{}{\printtext{\addcomma\addspace\printfield{courtfullname}}}%
\iffieldundef{postnote}{}{%
\iffieldundef{partya}{%
\addcomma\addspace\usebibmacro{postnote}}{}%
\adddot}%
\footnotemark
}%end parbox
}%
{%
%\multicitedelim%
}%
{}

\DeclareCiteCommand{ycite}%
{\usebibmacro{prenote}}%
{%
\iffieldundef{yoptions}{}{\forcsvfield{\getblcommand}{yoptions}}%
}%
{%
\multicitedelim%
}%
{\usebibmacro{postnote}}




%aglc -------------------
\DeclareFieldFormat[case]{aglc:case:item:titlepart:partya:format}{\mkbibitalic{#1}}
\DeclareFieldFormat[case]{aglc:case:item:titlepart:partya:delim}{\addspace}
\DeclareFieldFormat[case]{aglc:case:item:titlepart:partysep:format}{\mkbibitalic{#1}}
\DeclareFieldFormat[case]{aglc:case:item:titlepart:partysep:delim}{\addspace}
\DeclareFieldFormat[case]{aglc:case:item:titlepart:partyb:format}{\mkbibitalic{#1}}
\DeclareFieldFormat[case]{aglc:case:item:titlepart:partyb:delim}{\addspace}
%-
\DeclareFieldFormat[case]{aglc:case:item:refmnc:year:format}{\mkbibbrackets{#1}}
\DeclareFieldFormat[case]{aglc:case:item:refmnc:year:delim}{\addspace}
\DeclareFieldFormat[case]{aglc:case:item:refmnc:courtname:format}{#1}
\DeclareFieldFormat[case]{aglc:case:item:refmnc:courtname:delim}{\addspace}
\DeclareFieldFormat[case]{aglc:case:item:refmnc:casenumber:format}{#1}
\DeclareFieldFormat[case]{aglc:case:item:refmnc:casenumber:delim}{}
%
\DeclareFieldFormat[case]{aglc:case:item:report:reportyear:format}{\iffieldundef{volyearneeded}{\mkbibparens{#1}}{\mkbibbrackets{#1}}}
\DeclareFieldFormat[case]{aglc:case:item:report:reportyear:delim}{\addspace}
\DeclareFieldFormat[case]{aglc:case:item:report:reportvolume:format}{#1}
\DeclareFieldFormat[case]{aglc:case:item:report:reportvolume:delim}{\addspace}
\DeclareFieldFormat[case]{aglc:case:item:report:reportseries:format}{#1}
\DeclareFieldFormat[case]{aglc:case:item:report:reportseries:delim}{\addspace}
\DeclareFieldFormat[case]{aglc:case:item:report:reportpage:format}{#1}
\DeclareFieldFormat[case]{aglc:case:item:report:reportpage:delim}{}
\DeclareFieldFormat[case]{aglc:case:item:postnoteprelim}{\addcomma}%


%mcgill -------------------
\DeclareFieldFormat[case]{mcgill:case:item:titlepart:partya:format}{\mkbibitalic{#1}}
\DeclareFieldFormat[case]{mcgill:case:item:titlepart:partya:delim}{\addspace}
\DeclareFieldFormat[case]{mcgill:case:item:titlepart:partysep:format}{\mkbibitalic{#1}}
\DeclareFieldFormat[case]{mcgill:case:item:titlepart:partysep:delim}{\addspace}
\DeclareFieldFormat[case]{mcgill:case:item:titlepart:partyb:format}{\mkbibitalic{#1}}
\DeclareFieldFormat[case]{mcgill:case:item:titlepart:partyb:delim}{\addcomma\addspace}
%-
\DeclareFieldFormat[case]{mcgill:case:item:refmnc:year:format}{#1}
\DeclareFieldFormat[case]{mcgill:case:item:refmnc:year:delim}{\addspace}
\DeclareFieldFormat[case]{mcgill:case:item:refmnc:courtname:format}{#1}
\DeclareFieldFormat[case]{mcgill:case:item:refmnc:courtname:delim}{\addspace}
\DeclareFieldFormat[case]{mcgill:case:item:refmnc:casenumber:format}{#1}
\DeclareFieldFormat[case]{mcgill:case:item:refmnc:casenumber:delim}{}
%
\DeclareFieldFormat[case]{mcgill:case:item:report:reportyear:format}{#1}
\DeclareFieldFormat[case]{mcgill:case:item:report:reportyear:delim}{\addspace}
\DeclareFieldFormat[case]{mcgill:case:item:report:reportvolume:format}{#1}
\DeclareFieldFormat[case]{mcgill:case:item:report:reportvolume:delim}{\addspace}
\DeclareFieldFormat[case]{mcgill:case:item:report:reportseries:format}{#1}
\DeclareFieldFormat[case]{mcgill:case:item:report:reportseries:delim}{\addspace}
\DeclareFieldFormat[case]{mcgill:case:item:report:reportpage:format}{#1}
\DeclareFieldFormat[case]{mcgill:case:item:report:reportpage:delim}{}
\DeclareFieldFormat[case]{mcgill:case:item:postnoteprelim}{}%




%=============
\newcommand\mcdelim{}

\newbibmacro{set:multidelim}{%
 \ifboolexpr{%
  not test {\iffirstcitekey}%if 2nd+ cite
  and
  not test {\iffieldundef{prenote}}%and a prenote
  }%
	{%
%	\renewcommand\mcdelim{\multicitedelim}
%	\renewcommand{\multicitedelim}{\adddot\addspace}%
	\adddot\addspace
	}%
	{%
%	\renewcommand{\multicitedelim}{\addsemicolon\addspace}%
	}%
}


\newbibmacro{yy:case:partya}{%
%if new sentence in multicites:
\iffieldundef{partya}{}{%
\printfield[\lguide :case:item:titlepart:partya:format]{partya}%
\printfield[\lguide :case:item:titlepart:partya:delim]{partya}%
}%
}

\newbibmacro{yy:case:partyb}{%
\iffieldundef{partyb}{}{%
\iffieldundef{partysep}{%default partysep
\printtext[\lguide :case:item:titlepart:partysep:format]{\bibstring{versus}\addspace}%
}{%
\printfield[\lguide :case:item:titlepart:partysep:format]{partysep}%
\printfield[\lguide :case:item:titlepart:partysep:delim]{partysep}%
}%end partysep
\printfield[\lguide :case:item:titlepart:partyb:format]{partyb}%
\printfield[\lguide :case:item:titlepart:partyb:delim]{partyb}%
}%end partyb
}


\newbibmacro{yycore:mnc:caseyear}{%
\printfield[\lguide :case:item:refmnc:year:format]{caseyear}%
\printfield[\lguide :case:item:refmnc:year:delim]{caseyear}%
}

\newbibmacro{yycore:mnc:courtname}{%
\printfield[\lguide :case:item:refmnc:courtname:format]{
courtname}%
\printfield[\lguide :case:item:refmnc:courtname:delim]{courtname}%}%
}

\newbibmacro{yycore:mnc:casenumber}{%
\printfield[\lguide :case:item:refmnc:casenumber:format]{casenumber}%
\printfield[\lguide :case:item:refmnc:casenumber:delim]{casenumber}%
}




\newbibmacro{yy:case:mnc}{%
\iffieldundef{casenumber}{}{%
\usebibmacro{yycore:mnc:seq}%
}%end mnc
}


\newbibmacro{yy:case:report}{%
\iffieldundef{reportpage}{}{%
\usebibmacro{yycore:report:seq}%
}%end report
}


\newbibmacro{yycore:report:reportyear}{%
\printfield[\lguide :case:item:report:reportyear:format]{reportyear}%
\printfield[\lguide :case:item:report:reportyear:delim]{reportyear}%
}
\newbibmacro{yycore:report:reportvolume}{%
\printfield[\lguide :case:item:report:reportvolume:format]{reportvolume}%
\printfield[\lguide :case:item:report:reportvolume:delim]{reportvolume}%
}
\newbibmacro{yycore:report:reportseries}{%
\printfield[\lguide :case:item:report:reportseries:format]{reportseries}%
\printfield[\lguide :case:item:report:reportseries:delim]{reportseries}%
}
\newbibmacro{yycore:report:reportpage}{%
\printfield[\lguide :case:item:report:reportpage:format]{reportpage}%
\printfield[\lguide :case:item:report:reportpage:delim]{reportpage}%
}


\newbibmacro{yycore:report:seq}{%
\usebibmacro{yycore:report:reportyear}%
\usebibmacro{yycore:report:reportvolume}%
\usebibmacro{yycore:report:reportseries}%
\usebibmacro{yycore:report:reportpage}%
}



\newbibmacro{yycore:mnc:seq}{%
\usebibmacro{yycore:mnc:caseyear}%
\usebibmacro{yycore:mnc:courtname}%
\usebibmacro{yycore:mnc:casenumber}%
}

\newbibmacro{yycore:seq}{%
\usebibmacro{yy:case:partya}%
\usebibmacro{yy:case:partyb}%
\usebibmacro{yy:case:mnc}%
\usebibmacro{yy:case:report}%	
}

\newbibmacro{yycore:postnoteprelim}{%
\iffieldundef{postnote}{}{%
\iflastcitekey{%
\printtext[\lguide :case:item:postnoteprelim]{\usebibmacro{postnote}}%
}{}%
}%
}

\newbibmacro{yycore}{%
%\usebibmacro{set:multidelim}%
\usebibmacro{yycore:seq}%
\usebibmacro{yycore:postnoteprelim}%
}


\newcommand\lguide{}

\DeclareCiteCommand{yycite}%
{\usebibmacro{prenote}}%
{%
\usebibmacro{yycore}%
}%
{%
\multicitedelim%
}%
{\usebibmacro{postnote}}



\DeclareCiteCommand{yyfootcite}[\mkbibfootnote]%
{\usebibmacro{prenote}}%
{%
\usebibmacro{yycore}%
}%
{%
\multicitedelim%
}%
{\usebibmacro{postnote}}


\DeclareCiteCommand{yyparencite}[\mkbibparens]%
{\usebibmacro{prenote}}%
{%
\usebibmacro{yycore}%
}%
{%
\multicitedelim%
}%
{\usebibmacro{postnote}}



%============= lawcite
\DeclareCiteCommand{lawcite}%
%%caseallabove      reftypemode}{1}}{}
%%caseabovebelow  reftypemode}{2}}{}
%%caseallbelow      reftypemode}{3}}{}
%%casetitleonly     reftypemode}{4}}{}
%%caserefonly       reftypemode}{5}}{}
%@@@@@@@@@@@@@@@@ prenote
{%
\ifboolexpr{%
test {\ifentrytype{statute}}%
}%
{%start statute true
\usebibmacro{prenote}%
}% end statute true
{%
 \ifcase\thereftypemode \or%
 \usebibmacro{prenote}%inline
 \or% prenote goes inline for this variation, footnote has the case ref.
 \or% prenote is already in the footnote
 \or\usebibmacro{prenote}%
  \fi%
}%end statute false
}%
%@@@@@@@@@@@@@@@@ item
{%
%% \ifentrytype{case}{xxx}{zyyy}%does not work
% \iffieldequalstr{entrytype}{case}{xxx}{zyyy}%works
\ifboolexpr{%
test {\ifentrytype{statute}}%
}%
{%start statute true
\iffieldundef{citeref}{%
  \iffieldundef{statutechapter}{%
  \usebibmacro{getstatutenameref}%
  \usebibmacro{getnote}%
  \ifkeyword{regulations}{\toggletrue{printxregulations}}{\togglefalse{printxregulations}}%
\iftoggle{lcindexing}{%
  \sindex[\lctor]{\thefield{statutetitle}\iftoggle{stattycomma}{,}{} \thefield{statutetitleyear}\iftoggle{statjurisdiction}{\iffieldundef{statutejurisdiction}{}{ (\thefield{statutejurisdiction})}}{}%\usebibmacro{getnote}%
\iffieldundef{note}{}{ (\thefield{note})}%
\lcparnumrefsencap}}{}%
  \togglefalse{printxregulations}
   }{\usebibmacro{getcanreg}}%end canreg
}%end: no citeref
{%start false: citeref exists
\usebibmacro{getcanleg}%
\usebibmacro{getcanreg2}%
}%end citeref
\iffieldundef{postnote}{}{\addcomma\usebibmacro{notmnc:postnote}}%
\iffieldundef{url}{}{\addspace\printtext[angles]{\usebibmacro{getcaseurl}}}% 
}%end statute true
{%
%\thefield{entrykey}\the\value{citecounter}::
%\ifnumequal{\value{citecounter}}{1}{FIRST}{xxx}%
%\iffirstcitekey{>>\thefield{entrykey}	\the\value{instcount}<<}{}
%\ifciteseen{\ifciteibid{SEENIBID}{SEEN}}{}%
 \ifcase\thereftypemode%
 \or\usebibmacro{getcasenameref}\usebibmacro{getnote}%
 \or\usebibmacro{prenote}\usebibmacro{getcasename}\mkbibfootnote{\usebibmacro{getcaseref}\usebibmacro{getnote}\usebibmacro{notmnc:postnote}}%
 \or\mkbibfootnote{\usebibmacro{prenote}\usebibmacro{getcasenameref}\usebibmacro{getnote}\usebibmacro{notmnc:postnote}}%
 \or\usebibmacro{getcasename}%
 \fi%
\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
%
%\usebibmacro{fullstepindex}% ???
}% end statute false
}%end item
%@@@@@@@@@@@@@@@@ delim
{%
 \multicitedelim%
%% \ifcase\thereftypemode \or%
%% \multicitedelim%
%% \or\addcomma%
%% \or\multicitedelim%
%% \or\addcomma\addspace%
%%  \fi%
}%
%@@@@@@@@@@@@@@@@ postnote
{%
%%	: general setup:
%		\iftoggle{ibidpostdelimcomma}{\setpostnotedelimon}{\setpostnotedelimoff}
%
\ifboolexpr{%
test {\ifentrytype{statute}}%
}%
{\iffieldundef{postnote}{}{\usebibmacro{mnc:postnote}}}%statute true
{%case
%%	if ibid, use postnote
% \ifboolexpr{%
%  test {\ifcitation}
%  and
%  test {\ifciteibid}
%  }%
%	{\usebibmacro{postnote}}{%
%%	    otherwise if mnc:pn then {}
%				\iftoggle{pinpointaftermnc}{PPAMNC}{%
%%	    otherwise:
%%\iftoggle{usedibid}{\textcolor{red}{AA}}{%
 \ifcase\thereftypemode \or%
 \usebibmacro{postnote}% inline
 \or% prenote goes inline for this variation, footnote has the case ref.
 \or% postnote is already in the footnote
 \or \usebibmacro{postnote}
 \fi%
%% }%end: ibid used
%% \togglefalse{usedibid}%\textcolor{red}{AA}
% }%end: not mnc:pn
% }%end: not ibid
}%not statute
}



%============= lawcite head foot: only for cases
\DeclareCiteCommand{lawcitehf}%
{%
\usebibmacro{prenote}%
}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getcasename}%
\mkbibfootnote{%
    \usebibmacro{getcaseref}\usebibmacro{getnote}%\usebibmacro{postnote}%
    }%
\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{fullstepindex}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{%
 \multicitedelim%
}%
%@@@@@@@@@@@@@@@@ postnote
{%
\usebibmacro{postnote}
}%

%============= lawcite head foot with name: only for cases
\DeclareCiteCommand{lawcitehfn}%
{%
\usebibmacro{prenote}%
}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getcasename}%
\mkbibfootnote{%
    \usebibmacro{getcasenameref}\usebibmacro{getnote}%\usebibmacro{postnote}%
    }%
\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{fullstepindex}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{%
 \multicitedelim%
}%
%@@@@@@@@@@@@@@@@ postnote
{%
\usebibmacro{postnote}
}%







%============= lawciterr
\DeclareCiteCommand{lawciterr}%
%%caseallabove      reftypemode}{1}}{}
%%caseabovebelow  reftypemode}{2}}{}
%%caseallbelow      reftypemode}{3}}{}
%%casetitleonly     reftypemode}{4}}{}
%%caserefonly       reftypemode}{5}}{}
%@@@@@@@@@@@@@@@@ prenote
{%
 \ifcase\thereftypemode \or%
 \usebibmacro{prenote}%inline
 \or% prenote goes inline for this variation, footnote has the case ref.
 \or% prenote is already in the footnote
 \or\usebibmacro{prenote}%
  \fi%
}%
%@@@@@@@@@@@@@@@@ item
{%
%% \ifentrytype{case}{xxx}{zyyy}%does not work
% \iffieldequalstr{entrytype}{case}{xxx}{zyyy}%works
 \ifcase\thereftypemode%
 \or\iffirstcitekey{\usebibmacro{getcasenameref}}{\usebibmacro{getcaseref}}%
 \or\usebibmacro{prenote}\iffirstcitekey{\usebibmacro{getcasename}}{}\mkbibfootnote{\usebibmacro{getcaseref}\usebibmacro{postnote}}%
 \or\mkbibfootnote{\usebibmacro{prenote}\iffirstcitekey{\usebibmacro{getcasenameref}}{\usebibmacro{getcaseref}}\usebibmacro{postnote}}%
 \or\usebibmacro{getcasename}%
 \fi%
\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
%
\usebibmacro{fullstepindex}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{%
 \ifcase\thereftypemode \or%
 \usebibmacro{postnote}% inline
 \or% prenote goes inline for this variation, footnote has the case ref.
 \or% postnote is already in the footnote
 \or\usebibmacro{postnote}
 \fi%
}






%%%============= lawciterr
%%\DeclareCiteCommand{lawciterr}%
%%%%caseallabove      reftypemode}{1}}{}
%%%%caseabovebelow  reftypemode}{2}}{}
%%%%caseallbelow      reftypemode}{3}}{}
%%%%casetitleonly     reftypemode}{4}}{}
%%%%caserefonly       reftypemode}{5}}{}
%%%@@@@@@@@@@@@@@@@ prenote
%%{%
%% \ifcase\thereftypemode \or%
%% \usebibmacro{prenote}%inline
%% \or% prenote goes inline for this variation, footnote has the case ref.
%% \or% prenote is already in the footnote
%% \or\usebibmacro{prenote}%
%%  \fi%
%%}%
%%%@@@@@@@@@@@@@@@@ item
%%{%
%%%% \ifentrytype{case}{xxx}{zyyy}%does not work
%%% \iffieldequalstr{entrytype}{case}{xxx}{zyyy}%works
%% \ifcase\thereftypemode%
%% \or\usebibmacro{getcasenameref}%
%% \or\usebibmacro{prenote}\usebibmacro{getcasename}\mkbibfootnote{\usebibmacro{getcaseref}\usebibmacro{postnote}}%
%% \or\mkbibfootnote{\usebibmacro{prenote}\usebibmacro{getcasenameref}\usebibmacro{postnote}}%
%% \or\usebibmacro{getcasename}%
%% \fi%
%%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
%%%
%%\usebibmacro{rrindex}%
%%}%end item
%%%@@@@@@@@@@@@@@@@ delim
%%{\multicitedelim}%
%%%@@@@@@@@@@@@@@@@ postnote
%%{%
%% \ifcase\thereftypemode \or%
%% \usebibmacro{postnote}% inline
%% \or% prenote goes inline for this variation, footnote has the case ref.
%% \or% postnote is already in the footnote
%% \or\usebibmacro{postnote}
%% \fi%
%%}







%============= lawcitetitle
\DeclareCiteCommand{lawcitetitle}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{fullstepindex}%
\usebibmacro{getcasename}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}


%============= lawcitetitlerr
\DeclareCiteCommand{lawcitetitlerr}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{rrindex}%
\iffirstcitekey{\usebibmacro{getcasename}}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}


%============= lawciteref
\DeclareCiteCommand{lawciteref}%
%@@@@@@@@@@@@@@@@ prenote
{}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{fullstepindex}%
\usebibmacro{prenote}\usebibmacro{getcaseref}\usebibmacro{postnote}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{}



%============= lcrefnn  %no note
\DeclareCiteCommand{lcrefnn}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{fullstepindex}%
\usebibmacro{getcaseref}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}


%============= lawciterefrr
\DeclareCiteCommand{lawciterefrr}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
%\usebibmacro{fullstepindex}%
\usebibmacro{rrindex}%
\usebibmacro{getcaseref}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}






%============= lcrefnnrr  %no note
\DeclareCiteCommand{lcrefnnrr}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{rrindex}%
\usebibmacro{getcaseref}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}




%============= lcnote
\DeclareCiteCommand{lcnote}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{fullstepindex}%
\usebibmacro{getnote}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}



%============= lcnoterr
\DeclareCiteCommand{lcnoterr}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{rrindex}%
\iffirstcitekey{\usebibmacro{getnote}}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}




%============= lcshorttitle
\DeclareCiteCommand{lcshorttitle}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\usebibmacro{sendtocaseindex}%
\usebibmacro{fullstepindex}%
\usebibmacro{getcaseshortname}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}



%============= lcshorttitlerr
\DeclareCiteCommand{lcshorttitlerr}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\usebibmacro{sendtocaseindex}%
\usebibmacro{rrindex}%
\iffirstcitekey{\usebibmacro{getcaseshortname}}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}



%============= lccasesn
\DeclareCiteCommand{lccasesn}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\usebibmacro{sendtocaseindex}%
\usebibmacro{fullstepindex}%
\usebibmacro{getcasesn}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}




%============= lcnickname
\DeclareCiteCommand{lcnickname}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\usebibmacro{sendtocaseindex}%
\usebibmacro{fullstepindex}%
\usebibmacro{getcasenickname}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}



%============= lcnicknamerr
\DeclareCiteCommand{lcnicknamerr}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\usebibmacro{sendtocaseindex}%
%%\usebibmacro{fullstepindex}%
\usebibmacro{rrindex}%
\iffirstcitekey{\usebibmacro{getcasenickname}}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}



%\newtoggle{notecolour}
%\togglefalse{notecolour}
%\newcommand\nn{\toggletrue{notecolour}}
%\iftoggle{notecolour}{\bfseries xx}{yy}

%%%\thefield{courtname} \thefield{mncnumber}} %
%%%\iffieldundef{rptseries}{}{, \iffieldundef{rptyear}{}{\iffieldundef{rptvolume}{[}{(}\thefield{rptyear}\iffieldundef{rptvolume}{]}{)}} \iffieldundef{rptvolume}{}{\thefield{rptvolume}} \thefield{rptseries} \thefield{rptpage}


\newbibmacro{sendtocaseindex}{%
\ifboolexpr{%
test {\ifentrytype{case}}%
}%
{%true
\usebibmacro{indexcaseparm}%
%\iffirstcitekey{%
%%%%%\iftoggle{lcindexing}{%
%%%%%\sindex[cases]{\iffieldundef{shipname}{\thefield{partya}\iffieldundef{partyajur}{}{ (\thefield{partyajur})}%no space, for one party only; space if partyb (before v)
%%%%%\iffieldundef{partyb}{}{ \iffieldundef{partysep}{v}{\thefield{partysep}} \thefield{partyb}\iffieldundef{partybjur}{}{ (\thefield{partybjur})}}}{\thefield{shipname}, The}%
%%%%%\iftoggle{refintoc}{% 1st character is a space
%%%%%\iftoggle{commainindex}{,}{}\addspace\iffieldundef{casenumber}{}{\iftoggle{mncbrackets}{[}{}\thefield{caseyear}\iftoggle{mncbrackets}{]}{} \thefield{courtname} \thefield{casenumber}}%
%%%%%%\iffieldundef{reportpage}{}{\thefield{reportyear} \thefield{reportvolume} \thefield{reportseries} \thefield{reportpage}} %
%%%%%\iffieldundef{reportpage}{}{%
%%%%%\iffieldundef{casenumber}{}{;}%
%%%%%\iffieldundef{reportyear}{}{%
%%%%%\iffieldundef{reportvolume}{ [}{%
%%%%%\iffieldundef{volyearneeded}{ (}{ [}}%
%%%%%\thefield{reportyear}%
%%%%%\iffieldundef{reportvolume}{]}{%
%%%%%\iffieldundef{volyearneeded}{)}{]}} }%
%%%%%\thefield{reportvolume} %
%%%%%\thefield{reportseries} %  use \mkbibordinal{}?
%%%%%\thefield{reportpage}%
%%%%%}%end if reportpage
%%%%%}%end refintoc true
%%%%%{%start reefintoc false
%%%%%\iffieldundef{icaseyear}{\iffieldundef{caseyear}{\iffieldundef{reportyear}{}{ (\thefield{reportyear})}}{ (\thefield{caseyear})}}{ (\thefield{icaseyear})}%
%%%%%}%end refintoc false
%%%%%\lcparnumrefsencap}}{}%end sindex
%}%end \iffirstcitekey
}%end true
{%false
\ifboolexpr{%
test {\ifentrytype{statute}}%
}%
{%
\ifkeyword{regulations}{\toggletrue{printxregulations}}{\togglefalse{printxregulations}}%
\iftoggle{lcindexing}{%
\sindex[\lctor]{\thefield{statutetitle} \thefield{statutetitleyear}\lcparnumrefsencap}}{}%
\togglefalse{printxregulations}%
}%
{}%
}%end false
}






\newbibmacro{getindexcasename}{%
\ifboolexpr{%
test {\ifentrytype{case}}%
}%
{%true
\renewcommand\lcindexaccum{}%empty
\xappto\lcindexaccum{%
%partynames = casename
\iffieldundef{shipname}{\thefield{partya}\iffieldundef{partyajur}{}{ (\thefield{partyajur})}%no space, for one party only; space if partyb (before v)
\iffieldundef{partyb}{}{ \iffieldundef{partysep}{v}{\thefield{partysep}} \thefield{partyb}\iffieldundef{partybjur}{}{ (\thefield{partybjur})}}}{\thefield{shipname}, The}%
}%end accum
}%end true
{%false
}%end case false
}


%-----------------
\newbibmacro{getindexcaseref}{%
\xappto\lcindexaccum{%
%\thefield{courtname}; \thefield{reportseries}
%caseref
%\iftoggle{refintoc}{%   space 1st character of line below
\iftoggle{commainindex}{,}{}\addspace\iffieldundef{casenumber}{}{\iftoggle{mncbrackets}{[}{}\thefield{caseyear}\iftoggle{mncbrackets}{]}{} \thefield{courtname} \thefield{casenumber}}%
%\iffieldundef{reportpage}{}{\thefield{reportyear} \thefield{reportvolume} \thefield{reportseries} \thefield{reportpage}} %
\iffieldundef{reportpage}{}{%
\iffieldundef{casenumber}{}{;}%
\iffieldundef{reportyear}{}{%
\iffieldundef{reportvolume}{ [}{%
\iffieldundef{volyearneeded}{ (}{ [}}%
\thefield{reportyear}%
\iffieldundef{reportvolume}{]}{%
\iffieldundef{volyearneeded}{)}{]}} }%
\thefield{reportvolume} %
\thefield{reportseries} %  use \mkbibordinal{}?
\thefield{reportpage}%
}%end if reportpage
%}%end refintoc true
%{%start reefintoc false
%\iffieldundef{icaseyear}{\iffieldundef{caseyear}{\iffieldundef{reportyear}{}{ (\thefield{reportyear})}}{ (\thefield{caseyear})}}{ (\thefield{icaseyear})}%
%}%end refintoc false
}%caseref accum
}

\DeclareFieldFormat{doublequotes}{^^^^201c#1^^^^201d}
%\DeclareFieldFormat{dblquoteslig}{``#1''}
\DeclareFieldFormat{quotes}{\mkbibquote{#1}}
\DeclareFieldFormat{parens}{\mkbibparens{#1}}
\DeclareFieldFormat{emph}{\mkbibemph{#1}}
\DeclareFieldFormat{angles}{<#1>}
\DeclareFieldFormat{plain}{#1}

\DeclareNameFormat{authorinbib}{%
   \ifthenelse{\value{listcount}=1}{%true
    \namepartfamily%
    \ifdefvoid{\namepartgiven}{}{\addcomma\space\namepartgiven}}%end true
    {%false
    \ifdefvoid{\namepartgiven}{}{\namepartgiven\space}%
    \namepartfamily}%end false
   \ifthenelse{\value{listcount}<\value{liststop}}{\addcomma\space}{}%
}

\DeclareNameFormat{authorplain}{%
%\ifthenelse{\value{listcount}=1}
%{\namepartfamily%
%\ifdefvoid{\namepartgiven}{}{
%,! \addcomma\space\namepartgiven}}
{%
\ifdefvoid{\namepartgiven}{}{\namepartgiven\space}%
\namepartfamily}%
\ifthenelse{\value{listcount}<\value{liststop}}
{\addcomma\space}
{}}


\DeclareNameFormat{authorplainlast}{%
\mkbibemph{%
\ifthenelse{\value{listcount}=1}%
  {}%add nothing
  {%otherwise
 \ifthenelse{\value{listcount}<\value{liststop}}%
    {\addcomma}%
    {\addspace\bibstring{and}}%
  \addspace%
  }%
  \namepartfamily%
}}


%\DeclareNameFormat{authorplainlast}{%
%\mkbibemph{\namepartfamily%
%\ifboolexpr{%
%  test {\value{liststop}=1}
%  }%
%  {}%nothing
%  {%otherwise
% \ifboolexpr{%
%   test {\value{listcount}<\value{liststop}}
%   }%
%    {\addcomma}%
%    {\addspace\bibstring{and}}
%  \addspace}%
%  }%
%}

%\DeclareNameFormat{authorplainlast}{%
%\mkbibemph{\namepartfamily%
%\ifthenelse{\value{listcount}<\value{liststop}}%
%{\ifthenelse{\value{listcount}=\value{liststop}}%
%{\bibstring{and}}{\addcomma}%
%\space}%
%{}}}

\DeclareNameFormat{authorsc}{%
\textsc{\namepartfamily}%
}
%\ifthenelse{\value{listcount}=1}
%{\namepartfamily%
%\ifdefvoid{\namepartgiven}{}{
%,! \addcomma\space\namepartgiven}}
%{%
%\ifdefvoid{\namepartgiven}{}{\namepartgiven\space}%
%\namepartfamily}%
%\ifthenelse{\value{listcount}=1}
%{\textsc{\namepartfamily}}
%{}}


\DeclareListFormat[case]{parallel}{%
#1%
\ifthenelse{\value{listcount}<\value{listtotal}}
{\addcomma\space}
{}}


\newbibmacro{getparallelreports}{%
\iflistundef{parallel}{}{\setunit*{\addcomma\space}\printlist[][-\value{listtotal}]{parallel}\newunit\newblock}%
}





%\newcommand*{\begrelateddelimmultivolume}{\newunitpunct\par\nobreak}
%\renewcommand*{\begrelateddelimmultivolume}{\newunitpunct\addspace}
%\newcommand*{\relateddelim}{\adddot\par\nobreak}
\renewcommand*{\relateddelim}{\adddot\addspace}

\newbibmacro{getljarticleauthor}{%
 \ifbibliography{%inbib true
  \ifnameundef{author}{}%no author true
  %no author details to get; end no author true
  {% no author false: there is an author field
   \printnames[authorinbib]{author}%
  }%end no author false
 }%end inbib true
 {%inbib false
 \printnames[authorplain][-\value{listtotal}]{author}%
 }
}

\newbibmacro{getljarticleauthorsc}{%
\printnames[authorsc][-1]{author}%
}


\newbibmacro{getljarticletitle}{%
\iftoggle{ljarttitleitalic}{%
\printtext[emph]{\thefield{title}}\iffieldundef{subtitle}{}{\addcolon\addspace\printtext[emph]{\thefield{subtitle}}}%
}%end italic
{%not italic
\printfield[plain]{title}\iffieldundef{subtitle}{}{\addcolon\addspace\printfield[plain]{subtitle}}%
}%end not italic
}
%%%\newbibmacro{getljarticletitle}{%
%%%\printfield{title}\iffieldundef{subtitle}{}{\addcolon\addspace\printfield{subtitle}}%
%%%}




%\newbibmacro{getljarticlesubtitle}{%
%}
\newbibmacro{getljarticleyear}{%
\printtext[parens]{\thefield{year}}%
}
\newbibmacro{getljarticlevolume}{%
\printfield[plain]{volume}%
}
\newbibmacro{getljarticlejournaltitle}{%
\iftoggle{ljjnltitleitalic}{%
\printfield[emph]{journaltitle}%
}%
{%
\printfield[plain]{journaltitle}%
}%
}
\newbibmacro{getljarticlepage}{%
\printfield[plain]{pages}%
}



\newbibmacro{getljarticlequotes}{%
\iftoggle{ljarttitledoublequotes}{\iftoggle{ljarttitlequotes}{%
%double-single
\printtext[doublequotes]{\printtext[quotes]{\usebibmacro{getljarticletitle}}}}{%
%double
\printtext[doublequotes]{\usebibmacro{getljarticletitle}}}}{\iftoggle{ljarttitlequotes}{%
%single
\printtext[quotes]{\usebibmacro{getljarticletitle}}}{%
%none
\usebibmacro{getljarticletitle}}}
}
%\iftoggle{ljarttitledoublequoteslig}%
%{\iftoggle{ljarttitledoublequotes}%
%{\iftoggle{ljarttitlequotes}{\printtext[doublequoteslig]{\printtext[doublequotes]{\printtext[quotes]{\usebibmacro{getljarticletitle}}}}}
%{\usebibmacro{getljarticletitle}}
%}%
%{\iftoggle{ljarttitlequotes}{\printtext[quotes]{\usebibmacro{getljarticletitle}}}{\usebibmacro{getljarticletitle}}
%}%no q lig
%}%
%{\iftoggle{ljarttitledoublequotes}%
%{\iftoggle{ljarttitlequotes}{\printtext[quotes]{\usebibmacro{getljarticletitle}}}{\usebibmacro{getljarticletitle}}
%}%
%{\iftoggle{ljarttitlequotes}{\printtext[quotes]{\usebibmacro{getljarticletitle}}}{\usebibmacro{getljarticletitle}}
%}%no q lig
%}%no q lig
%}


%\newbibmacro{make:url:linkname}%
%{%
%}


\newbibmacro{getcaseurl}%
{%
\iffieldundef{url}{}{%
  \ifhyperref
    {%
    		\iffieldundef{linkname}{%
				    \url{\thefield{url}}
    				}%
    				{\href{\thefield{url}}{%
    												\thefield{linkname}%
    																					}}%
    }%
    {\nolinkurl{\thefield{url}}}%
}%
}


\newbibmacro{getljarticleurl}%
{%
\iffieldundef{url}{}{%
  \ifhyperref
    {%
    		\iffieldundef{mncnumber}{%
				    \url{\thefield{url}}
    				}%
    				{\href{\thefield{url}}{%
    												\thefield{mncyear}\addspace%
    												\thefield{mncname}\addspace%
    												\thefield{mncnumber}%
    																					}}%
    }%
    {\nolinkurl{\thefield{url}}}%
}%
}




\DeclareFieldFormat{shortname}{#1}




\newbibmacro{getljartshortname}{%
\iffieldundef{shortname}{}{\printfield{shortname}}%
}



\newtoggle{artibidtemp}
\togglefalse{artibidtemp}

\newcommand{\ibidprevpintemp}{}




\newbibmacro{getljarticle:ibid}{%
  \togglefalse{artibidtemp}%
 \togglefalse{usedibid}%
 \togglefalse{supranoteused}%
 \ifboolexpr{%
 not test {\iffootnote}
 }%
 {\usebibmacro{getljartshortname}}{%
 \ifboolexpr{%
  test {\ifcitation}
  and
  test {\ifciteibid}
  }%
  {%
  \toggletrue{usedibid}%
  \usebibmacro{getibid}%
%  \textcolor{red}{AA}%
  \iftoggle{ibidpostdelimcomma}%
  {\DeclareDelimFormat{postnotedelim}{\addcomma\space}}%
  {\DeclareDelimFormat{postnotedelim}{\space}}%
%%  \textcolor{red}{AA}%
  \toggletrue{artibidtemp}%
  \usebibmacro{postnote}%actual ibid
%%  \textcolor{red}{BB}%
  \DeclareDelimFormat{postnotedelim}{\addcomma\space}%restore
%  \textcolor{red}{BB}%
  }{%
 \ifboolexpr{%
  test {\ifcitation}
  and
  test {\ifciteseen}
  and
  not test {\ifciteibid}
  }%
  {\usebibmacro{getljartshortname}%
  \usebibmacro{getibidsupranote}\toggletrue{supranoteused}%
%  \textcolor{red}{AA}%
  \iftoggle{ibidpostdelimcomma}%
  {\DeclareDelimFormat{postnotedelim}{\addcomma\space}}%
  {\DeclareDelimFormat{postnotedelim}{\space}}%
  \usebibmacro{postnote}%
%  \textcolor{red}{BB}%
  \DeclareDelimFormat{postnotedelim}{\addcomma\space}%restore
  %
  }{%
 \usebibmacro{getljarticle}%
 %
 %true
 %false
 }}%ifciteibid false
 % label
 \ifboolexpr{%
  test {\ifcitation}
  and
  not test {\ifciteseen}
  and
  not test {\ifciteibid}
  }%
	{\label{cfn:\thefield{entrykey}}}{}%
}}

\newbibmacro{getljarticle}{%
\usebibmacro{getljarticleauthor}%
\ifbibliography{\adddot\space}{\addcomma\addspace}%
\usebibmacro{getljarticlequotes}%
\addcomma\addspace%
\usebibmacro{getljarticleyear}%
\addspace%
\usebibmacro{getljarticlevolume}%
\addspace%
\usebibmacro{getljarticlejournaltitle}%
\addspace%
\usebibmacro{getljarticlepage}%
\iffieldundef{related}{}{\addspace\usebibmacro{related}}%
\iffieldundef{url}{}{%
%put postnote before url:
\iffieldundef{postnote}{}{%
\DeclareDelimFormat{postnotedelim}{\addcomma\space}%restore
\usebibmacro{postnote}%
\addspace\printtext[angles]{\usebibmacro{getljarticleurl}}}}%
\newunit\newblock%
}


\newbibmacro{sendtoindexrr}{%
\iftoggle{lcindexing}{%
\sindex[cases]{%
%{%
%\color{red}%
\lcindexaccum%
%}%
\lcparnumrefsencap}}{}%
}



\newbibmacro{fullstepindex}{%name-ref for all keys: cases only
\ifboolexpr{%
test {\ifentrytype{case}}%
}%
{%true: is a case
\iftoggle{lcindexing}{%
\usebibmacro{getindexcasename}%
\usebibmacro{getindexcaseref}%
\usebibmacro{sendtoindexrr}%
}%end true
{}%false=is not case
}{}%
}




%indexer
\newbibmacro{rrindex}{%name for first key; refs for the rest
\iftoggle{lcindexing}{%
\iffirstcitekey{%
\usebibmacro{getindexcasename}%
}{}%firstcite
{%loopcite
\usebibmacro{getindexcaseref}%
}%end loopcite
\iflastcitekey{\usebibmacro{sendtoindexrr}}{}%
}{}%
}


%%%\newbibmacro{sendtocaseindex:nameref}{%
%%%\ifboolexpr{%
%%%test {\ifentrytype{case}}%
%%%}%
%%%{%true
%%%\thefield{partya}%no space, for one party only; space if partyb (before v)
%%%\iffieldundef{partyb}{}{ \iffieldundef{partysep}{v}{\thefield{partysep}} \thefield{partyb}}, %
%%%\iffieldundef{casenumber}{}{\iftoggle{mncbrackets}{[}{}\thefield{caseyear}\iftoggle{mncbrackets}{]}{} \thefield{courtname} \thefield{casenumber}}%
%%%\iffieldundef{reportpage}{}{%
%%%\iffieldundef{casenumber}{}{;}%
%%%\iffieldundef{reportyear}{}{%
%%%\iffieldundef{reportvolume}{ [}{%
%%%\iffieldundef{volyearneeded}{ (}{ [}}%
%%%\thefield{reportyear}%
%%%\iffieldundef{reportvolume}{]}{%
%%%\iffieldundef{volyearneeded}{)}{]}} }%
%%%\thefield{reportvolume} %
%%%\thefield{reportseries} %
%%%\thefield{reportpage}%
%%%}%end if reportpage
%%%}%end true
%%%{%false
%%%\ifboolexpr{%
%%%test {\ifentrytype{statute}}%
%%%}%
%%%{\sindex[legislation]{\thefield{statutetitle} \thefield{statutetitleyear}}}%
%%%{}%
%%%}%end false
%%%}
%%%
%%%
%%%
%%%\newbibmacro{sendtocaseindex:ref}{%
%%%\ifboolexpr{%
%%%test {\ifentrytype{case}}%
%%%}%
%%%{%true
%%%\multicitedelim%
%%%\iffieldundef{casenumber}{}{\iftoggle{mncbrackets}{[}{}\thefield{caseyear}\iftoggle{mncbrackets}{]}{} \thefield{courtname} \thefield{casenumber}}%
%%%\iffieldundef{reportpage}{}{%
%%%\iffieldundef{casenumber}{}{;}%
%%%\iffieldundef{reportyear}{}{%
%%%\iffieldundef{reportvolume}{ [}{%
%%%\iffieldundef{volyearneeded}{ (}{ [}}%
%%%\thefield{reportyear}%
%%%\iffieldundef{reportvolume}{]}{%
%%%\iffieldundef{volyearneeded}{)}{]}} }%
%%%\thefield{reportvolume} %
%%%\thefield{reportseries} %
%%%\thefield{reportpage}%
%%%}%end if reportpage
%%%}%end true
%%%{%false
%%%\ifboolexpr{%
%%%test {\ifentrytype{statute}}%
%%%}%
%%%{\sindex[legislation]{\thefield{statutetitle} \thefield{statutetitleyear}}}%
%%%{}%
%%%}%end false
%%%}





%%%\newcommand\lcindexaccum{}
%%%\newcommand\lcindexclear{\renewcommand\lcindexaccum{}}
%%%\newcommand\lcindexadd[1]{\renewcommand\lcindexaccum{#1}}
%%%
%%%
%%%\newbibmacro{sendtocaseindex:test}{%
%%%\ifboolexpr{%
%%%test {\ifentrytype{case}}%
%%%}%
%%%{%true
%%%\iffirstcitekey{\lcindexclear\xappto\lcindexaccum{%\usebibmacro{sendtocaseindex:nameref}
%%%\thefield{partya}%no space, for one party only; space if partyb (before v)
%%%\iffieldundef{partyb}{}{ \iffieldundef{partysep}{v}{\thefield{partysep}} \thefield{partyb}}, %
%%%\iffieldundef{casenumber}{}{\iftoggle{mncbrackets}{[}{}\thefield{caseyear}\iftoggle{mncbrackets}{]}{} \thefield{courtname} \thefield{casenumber}}%
%%%\iffieldundef{reportpage}{}{%
%%%\iffieldundef{casenumber}{}{;}%
%%%\iffieldundef{reportyear}{}{%
%%%\iffieldundef{reportvolume}{ [}{%
%%%\iffieldundef{volyearneeded}{ (}{ [}}%
%%%\thefield{reportyear}%
%%%\iffieldundef{reportvolume}{]}{%
%%%\iffieldundef{volyearneeded}{)}{]}} }%
%%%\thefield{reportvolume} %
%%%\thefield{reportseries} %
%%%\thefield{reportpage}%
%%%}%end if reportpage
%%%}}%true
%%%{\xappto\lcindexaccum{\usebibmacro{sendtocaseindex:ref}}}%false
%%%%\lcindexadd{y}
%%%%\gappto\lcindexaccum{y}
%%%\iflastcitekey{\edef\lcx{\lcindexaccum}\sindex[cases]{\lcx}}{}%
%%%}%end true
%%%{}}


%:
\newcommand\lcinlinecolour{red}
\newcommand\setlcinlinecolour[1]{\renewcommand\lcinlinecolour{#1}}

%first child:
\newcommand\lcinlinerrcolour{brown}
\newcommand\setlcinlinerrcolour[1]{\renewcommand\lcinlinerrcolour{#1}}

%subsequent children:
\newcommand\lcinlinerrcoloursc{blue}
\newcommand\setlcinlinerrcoloursc[1]{\renewcommand\lcinlinerrcoloursc{#1}}

\lcsetdemooff



%============= lcljauthorfn
\DeclareCiteCommand{lcljauthorfn}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticleauthorsc}%
\usebibmacro{fullstepindex}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}






%============= lcinline: only for cases
\DeclareCiteCommand{lcinline}%
%@@@@@@@@@@@@@@@@ prenote
{%
%\let\blx@ibidtracker\relax
%\textcolor{red}{AA}%
%\togglefalse{lcibidtracking}%
%\blx@opt@ibidtracker@false
%\ExecuteBibliographyOptions{ibidtracker=false}%
%\boolfalse{citetracker}%
%\boolfalse{pagetracker}%
%\boolfalse{citerequest}%
\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\ifboolexpr{%
test {\ifentrytype{case}}%
}%
{%true: is a case
%\togglefalse{lcibidtracking}%
\textcolor{\lcinlinecolour}{\usebibmacro{getcasenamerefnofn}}%no ibiding
\usebibmacro{fullstepindex}%
}%end true: is a case
{}%false = is not a case
}%end item
%@@@@@@@@@@@@@@@@ delim
{\iftoggle{multicitecomma}{\multicitecommadelim}{\multicitedelim}}%
%@@@@@@@@@@@@@@@@ postnote
%{\usebibmacro{postnote}\iflastcitekey{\addspace\usebibmacro{getnote}}{}}
{\usebibmacro{notmnc:postnote}\usebibmacro{getnote}}%{\iflastcitekey{\usebibmacro{postnote}\addspace\usebibmacro{getnote}}{\usebibmacro{postnote}}}



%============= lcinlinefull: only for cases
\DeclareCiteCommand{lcinlinefull}%
%@@@@@@@@@@@@@@@@ prenote
{%
%\let\blx@ibidtracker\relax
%\textcolor{red}{AA}%
%\togglefalse{lcibidtracking}%
%\blx@opt@ibidtracker@false
%\ExecuteBibliographyOptions{ibidtracker=false}%
%\boolfalse{citetracker}%
%\boolfalse{pagetracker}%
%\boolfalse{citerequest}%
\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\ifboolexpr{%
test {\ifentrytype{case}}%
}%
{%true: is a case
%\togglefalse{lcibidtracking}%
\textcolor{\lcinlinecolour}{\usebibmacro{getcasenamereffull}}%no ibiding
\usebibmacro{fullstepindex}%
}%end true: is a case
{}%false = is not a case
}%end item
%@@@@@@@@@@@@@@@@ delim
{\iftoggle{multicitecomma}{\multicitecommadelim}{\multicitedelim}}%
%@@@@@@@@@@@@@@@@ postnote
%{\usebibmacro{postnote}\iflastcitekey{\addspace\usebibmacro{getnote}}{}}
{\usebibmacro{notmnc:postnote}\usebibmacro{getnote}}%{\iflastcitekey{\usebibmacro{postnote}\addspace\usebibmacro{getnote}}{\usebibmacro{postnote}}}







%============= lcinlineparens: only for cases
\DeclareCiteCommand{lcinlineparens}[\mkbibparens]%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\ifboolexpr{%
test {\ifentrytype{case}}%
}%
{%true: is a case
\textcolor{\lcinlinecolour}{\usebibmacro{getcasenameref}}%
\usebibmacro{fullstepindex}%
}%end true: is a case
{}%false = is not a case
}%end item
%@@@@@@@@@@@@@@@@ delim
{\iftoggle{multicitecomma}{\multicitecommadelim}{\multicitedelim}}%
%@@@@@@@@@@@@@@@@ postnote
%{\usebibmacro{postnote}\iflastcitekey{\addspace\usebibmacro{getnote}}{}}
{\usebibmacro{notmnc:postnote}\usebibmacro{getnote}}%{\iflastcitekey{\usebibmacro{postnote}\addspace\usebibmacro{getnote}}{\usebibmacro{postnote}}}


%============= lcinlinerr
\DeclareCiteCommand{lcinlinerr}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%\ifentryseen{\thefield{crossref}}{\usebibmacro{getcaseref}}{\usebibmacro{getcasenameref}}%
%\iffieldxref{partya}{\usebibmacro{getcaseref}}{\usebibmacro{getcasenameref}}%
%\usebibmacro{sendtocaseindex:test}%
%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\iffirstcitekey{\textcolor{\lcinlinerrcolour}{\usebibmacro{getcasenameref}}}{\textcolor{\lcinlinerrcoloursc}{\usebibmacro{getcaseref}}}%
%%%indexer
%%\iffirstcitekey{%
%%\usebibmacro{getindexcasename}%
%%}{}%firstcite
%%{%loopcite
%%\usebibmacro{getindexcaseref}%
%%}%end loopcite
%%\iflastcitekey{\usebibmacro{sendtoindexrr}}{}%
\usebibmacro{rrindex}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\iftoggle{multicitecomma}{\multicitecommadelim}{\multicitedelim}}%
%@@@@@@@@@@@@@@@@ postnote
{\iflastcitekey{\usebibmacro{postnote}\iffieldundef{note}{}{\addspace\usebibmacro{getnote}}}{\usebibmacro{postnote}}}


%============= lcinlinenn  %no note
\DeclareCiteCommand{lcinlinenn}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%\ifentryseen{\thefield{crossref}}{\usebibmacro{getcaseref}}{\usebibmacro{getcasenameref}}%
%\iffieldxref{partya}{\usebibmacro{getcaseref}}{\usebibmacro{getcasenameref}}%
%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}% ??
\usebibmacro{fullstepindex}%
\usebibmacro{getcasenameref}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}



%============= lcinlinennrr  %no note
\DeclareCiteCommand{lcinlinennrr}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%\ifentryseen{\thefield{crossref}}{\usebibmacro{getcaseref}}{\usebibmacro{getcasenameref}}%
%\iffieldxref{partya}{\usebibmacro{getcaseref}}{\usebibmacro{getcasenameref}}%
%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}% ??
\usebibmacro{rrindex}%
\iffirstcitekey{\usebibmacro{getcasenameref}}{\usebibmacro{getcaseref}}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}








%%%%============= lawcitefoot
%%%\DeclareCiteCommand{lawcitefoot}%
%%%%@@@@@@@@@@@@@@@@ prenote
%%%{}%
%%%%@@@@@@@@@@@@@@@@ item
%%%{%
%%%%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
%%%\usebibmacro{fullstepindex}%
%%%\mkbibfootnote{\usebibmacro{prenote}\usebibmacro{getcasenameref}\usebibmacro{postnote}}%
%%%}%end item
%%%%@@@@@@@@@@@@@@@@ delim
%%%{\multicitedelim}%
%%%%@@@@@@@@@@@@@@@@ postnote
%%%{}
%%%

%============= lcfoot
\DeclareCiteCommand{lcfoot}[\mkbibfootnote]%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{fullstepindex}%
\usebibmacro{getcasenameref}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{notmnc:postnote}}





%============= lcfootfull
\DeclareCiteCommand{lcfootfull}[\mkbibfootnote]%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\usebibmacro{fullstepindex}%
\usebibmacro{getcasenamereffull}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{notmnc:postnote}}

%============= lcfootrr
\DeclareCiteCommand{lcfootrr}[\mkbibfootnote]%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
%%\iffirstcitekey{\usebibmacro{sendtocaseindex}}{}%
\iffirstcitekey{\usebibmacro{getcasenameref}}{\usebibmacro{getcaseref}}%
%%%indexer
%%\iffirstcitekey{%
%%\usebibmacro{getindexcasename}
%%}{}%firstcite
%%{%loopcite
%%\usebibmacro{getindexcaseref}
%%}%end loopcite
%%\iflastcitekey{\usebibmacro{sendtoindexrr}}{}
\usebibmacro{rrindex}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}


\newbibmacro{getciteref}{%
\iffieldundef{citeref}{}{\printtext{<\thefield{citeref}>}}
}


%============= lcciteref
\DeclareCiteCommand{lcciteref}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getciteref}
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}\iffieldundef{note}{}{\addspace\printfield[parens]{note}}%
}







%============= ljcite
\DeclareCiteCommand{ljcite}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticle}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{mnc:postnote}\iffieldundef{note}{}{\addspace\printfield[parens]{note}}%
}


%============= ljfootcite
\DeclareCiteCommand{ljfootcite}[\mkbibfootnote]%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticle:ibid}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{%
 \ifboolexpr{%
    test {\iftoggle{artibidtemp}}
%  test {\ifcitation}
%  and
%  test {\ifciteibid}
  }%
  {}%nothing
  {%if not ibid, then:
%%  \textcolor{red}{CC}%
		%if url, then postnote has already been printed
		\iffieldundef{url}{%
  \usebibmacro{postnote}%
  }{}%
%%  \textcolor{red}{DD}%
  \iffieldundef{note}{}{\addspace\printfield[parens]{note}}%
		}%
}



%============= lcpostnote
\DeclareCiteCommand{lcpostnote}%
%@@@@@@@@@@@@@@@@ prenote
{}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{postnote}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{}%
%@@@@@@@@@@@@@@@@ postnote
{}%


%============= lcljauthor
\DeclareCiteCommand{lcljauthor}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticleauthor}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%


%============= lcljtitle
\DeclareCiteCommand{lcljtitle}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticletitlequotes}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%


%============= lcljyear
\DeclareCiteCommand{lcljyear}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticleyear}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%


%============= lcljjournaltitle
\DeclareCiteCommand{lcljjournaltitle}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticlejournaltitle}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%


%============= lcljvolume
\DeclareCiteCommand{lcljvolume}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticlevolume}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%


%============= lcljpage
\DeclareCiteCommand{lcljpage}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getljarticlepage}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%





\DeclareCiteCommand{lcbook}[\mkbibfootnote]%
{\usebibmacro{prenote}}%
{%
%  \usebibmacro{publisher+location+date}%
%  book bib driver from ext-standard.bbx:
\iftoggle{bookauthorgiven}{\DeclareNameAlias[book]{author}{given-family}}{}%
  \usebibmacro{author/editor+others/translator+others}%
%%%  \printnames{author}
%%\usebibmacro{name:given-family}
%%         {\namepartfamily}
%%         {\namepartgiveni}
%%         {\namepartprefix}
%%         {\namepartsuffix}
%  \setunit{\printdelim{nametitledelim}}\newblock
	\addcomma\addspace%
	%====== dotless title
  \usebibmacro{maintitle+title}%
%  \setunit{\addspace}
\nopunct
%%%  \iffieldsequal{maintitle}{title}
%%%    {\clearfield{maintitle}%
%%%     \clearfield{mainsubtitle}%
%%%     \clearfield{maintitleaddon}}
%%%    {\iffieldundef{maintitle}
%%%       {}
%%%       {\usebibmacro{maintitle}%
%%%%        \newunit\newblock
%%%        \iffieldundef{volume}
%%%          {}
%%%          {\printfield{volume}%
%%%           \printfield{part}%
%%%           \setunit{\addcolon\space}}}}%
%%%  \usebibmacro{title}%
%%%%  \newunit  
%  
%  
%  
%  
%  \newunit
  \usebibmacro{language}%
%  \newunit\newblock
  \usebibmacro{byauthor}%
%  \newunit\newblock
  \usebibmacro{byeditor+others}%
%  \newunit\newblock
  \usebibmacro{edition}%
%  \newunit
  \usebibmacro{barevolume+volumes}%
%  \newunit\newblock
  \usebibmacro{series+number}%
%  \newunit\newblock
  \usebibmacro{note}%
%  \newunit\newblock
%	\addspace%
  \printtext{\mkbibparens{\usebibmacro{publisher+location+date}}}%
%  \newunit\newblock
  \usebibmacro{chapter+pages}%
%  \newunit
  \usebibmacro{pagetotal}%
%  \newunit\newblock
  \usebibmacro{isbn}%
%  \newunit\newblock
  \usebibmacro{doi+eprint+url}%
%  \newunit\newblock
  \usebibmacro{addendum+pubstate}%
  \setunit{\bibpagerefpunct}
%  \newblock
  \usebibmacro{pageref}%
%  \newunit\newblock
  \iftoggle{bbx:related}
    {\usebibmacro{related:init}%
     \usebibmacro{related}}
    {}%
}%
{\multicitedelim}%
{\usebibmacro{postnote}}%



%----------------------------------- Epigraph
\newbibmacro{getlastnames}{%
 \printnames[authorplainlast][-\value{listtotal}]{author}%
 }


\newbibmacro{gettitle}{%
\iffieldundef{shorttitle}{%
\printfield{title}}%
{\printfield[emph]{shorttitle}%
}
}

\newbibmacro{geteditionyear}{%
 \ifboolexpr{%
  not test {\iffieldundef{edition}}%if there is an edition
  or
  not test {\iffieldundef{year}}%or a year
  }%
{%true
\addspace%
\mkbibparens{%
\iffieldundef{edition}{}{%
\printfield{edition}%\textsuperscript{\bibstring{legaled}}%
\iffieldundef{year}{}{\addspace}}%end edition
\iffieldundef{year}{}{\printfield{year}}%
}%end psrens
}%end true
{}%false
}


%--------------------- for non-bib ``Clerk and Lindsall on Torts 4th ed''-type attribution
\newbibmacro{getlcepigraph}{%
\ifbibliography{}{%otherwise
\ifnameundef{author}{}{%otherwise
\usebibmacro{getlastnames}%
\addspace%
\mkbibemph{\bibstring{legalon}}
\addspace%
}%end name defined
\usebibmacro{gettitle}%
\usebibmacro{geteditionyear}%
}%end inbib=false
}


\newbibmacro{getlcepigraphp}{%
\ifbibliography{}{%otherwise
\ifnameundef{author}{}{%otherwise
\usebibmacro{getlastnames}%
\mkbibemph{\bibstring{possessive}}
\addspace%
}%end name defined
\usebibmacro{gettitle}%
}%end inbib=false
}




%============= lcepigraph
\DeclareCiteCommand{lcepigraph}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getlcepigraph}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%


%============= lcepigraphp: possessive x's y
\DeclareCiteCommand{lcepigraphp}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getlcepigraphp}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%



\newcommand\multicitecommadelim{\addcomma\addspace}

%\DeclareMultiCiteCommand{lawcites}[xxx]{lawcite}{\multicitedelim}
\DeclareMultiCiteCommand{\lawcitesinline}{lcinline}{\iftoggle{multicitecomma}{\multicitecommadelim}{\multicitedelim}}%different cases
\DeclareMultiCiteCommand{\lawcitesinlinerr}{lcinlinerr}{\iftoggle{multicitecomma}{\multicitecommadelim}{\multicitedelim}}%same case, different reports
\DeclareMultiCiteCommand{\lawcitesfoot}[\mkbibfootnote]{lcfoot}{\multicitedelim}
\DeclareMultiCiteCommand{\lawcitesfootrr}[\mkbibfootnote]{lcfootrr}{\multicitedelim}
%
\DeclareMultiCiteCommand{\yycites}{yycite}{\multicitedelim}
%
%%\DeclareMultiCiteCommand{\lawcitesinline}{lcinline}{\multicitedelim}%different cases


\newcommand{\lcidfield}[1]{%
#1 :: \iffieldundef{#1}{%not a field
\ifnameundef{#1}{%not a name list
\iflistundef{#1}{%not a list
\iffieldnum{#1}{%is numeric
existsnumeric}{notinentry}}{existslist}}{existsname}}{existsfield}
}

\DeclareCiteCommand{\lctestid}%
{}%
{%
%#1
\lcidfield{date}%
\lcidfield{year}%
}%
{}%
{}

\newcommand\lcffieldformat{\bfseries\color{blue}}
\newcommand\lcffield[1]{%
\noindent\iffieldundef{#1}{}{{\lcffieldformat#1} =  \{\thefield{#1}\},\par}%
}

\newbibmacro{getlcdcase}{%
{%
\ttfamily\ \par
@\thefield{entrytype}\{\thefield{entrykey},\par%
\noindent\iffieldundef{attribution}{}{attribution =  \{\thefield{attribution}\},\par}%
\noindent\iffieldundef{author}{}{author =  \{\thefield{author}\},\par}%
\noindent\iffieldundef{casename}{}{casename =  \{\thefield{casename}\},\par}%
\noindent\iffieldundef{casenickname}{}{casenickname =  \{\thefield{casenickname}\},\par}%
\noindent\iffieldundef{casenumber}{}{casenumber =  \{\thefield{casenumber}\},\par}%
\noindent\iffieldundef{caseshortname}{}{caseshortname =  \{\thefield{caseshortname}\},\par}%
\noindent\iffieldundef{casestatus}{}{casestatus =  \{\thefield{casestatus}\},\par}%
\noindent\iffieldundef{caseyear}{}{caseyear =  \{\thefield{caseyear}\},\par}%
\noindent\iffieldundef{chapter}{}{chapter =  \{\thefield{chapter}\},\par}%
\noindent\iffieldundef{citeref}{}{citeref =  \{\thefield{citeref}\},\par}%
\noindent\iffieldundef{courtcasenumber}{}{courtcasenumber =  \{\thefield{courtcasenumber}\},\par}%
\noindent\iffieldundef{courtdivision}{}{courtdivision =  \{\thefield{courtdivision}\},\par}%
\noindent\iffieldundef{courtfullname}{}{courtfullname =  \{\thefield{courtfullname}\},\par}%
\noindent\iffieldundef{courtjurisdiction}{}{courtjurisdiction =  \{\thefield{courtjurisdiction}\},\par}%
\noindent\iffieldundef{courtlist}{}{courtlist =  \{\thefield{courtlist}\},\par}%
\noindent\iffieldundef{courtname}{}{courtname =  \{\thefield{courtname}\},\par}%
\noindent\iffieldundef{date}{}{date =  \{\thefield{date}\},\par}%
\noindent\iffieldundef{decisionyear}{}{decisionyear =  \{\thefield{decisionyear}\},\par}%
\noindent\iffieldundef{fulldate}{}{fulldate =  \{\thefield{fulldate}\},\par}%
\noindent\iffieldundef{gazette}{}{gazette =  \{\thefield{gazette}\},\par}%
\noindent\iffieldundef{icaseyear}{}{icaseyear =  \{\thefield{icaseyear}\},\par}%
\noindent\iffieldundef{journaltitle}{}{journaltitle =  \{\thefield{journaltitle}\},\par}%
\noindent\iffieldundef{keywords}{}{keywords =  \{\thefield{keywords}\},\par}%
\noindent\iffieldundef{linkname}{}{linkname =  \{\thefield{linkname}\},\par}%
\noindent\iffieldundef{mncname}{}{mncname =  \{\thefield{mncname}\},\par}%
\noindent\iffieldundef{mncnumber}{}{mncnumber =  \{\thefield{mncnumber}\},\par}%
\noindent\iffieldundef{mncurl}{}{mncurl =  \{\thefield{mncurl}\},\par}%
\noindent\iffieldundef{mncyear}{}{mncyear =  \{\thefield{mncyear}\},\par}%
\noindent\iffieldundef{note}{}{note =  \{\thefield{note}\},\par}%
\noindent\iffieldundef{number}{}{number =  \{\thefield{number}\},\par}%
\noindent\iffieldundef{pages}{}{pages =  \{\thefield{pages}\},\par}%
\noindent\iffieldundef{pagination}{}{pagination =  \{\thefield{pagination}\},\par}%
\noindent\iffieldundef{parallel}{}{parallel =  \{\thefield{parallel}\},\par}%
\noindent\iffieldundef{partya}{}{partya =  \{\thefield{partya}\},\par}%
\noindent\iffieldundef{partyajur}{}{partyajur =  \{\thefield{partyajur}\},\par}%
\noindent\iffieldundef{partyasn}{}{partyasn =  \{\thefield{partyasn}\},\par}%
\noindent\iffieldundef{partyb}{}{partyb =  \{\thefield{partyb}\},\par}%
\noindent\iffieldundef{partybjur}{}{partybjur =  \{\thefield{partybjur}\},\par}%
\noindent\iffieldundef{partybsn}{}{partybsn =  \{\thefield{partybsn}\},\par}%
\noindent\iffieldundef{partysep}{}{partysep =  \{\thefield{partysep}\},\par}%
\noindent\iffieldundef{partysepx}{}{partysepx =  \{\thefield{partysepx}\},\par}%
\noindent\iffieldundef{regnum}{}{regnum =  \{\thefield{regnum}\},\par}%
\noindent\iffieldundef{reportpage}{}{reportpage =  \{\thefield{reportpage}\},\par}%
\noindent\iffieldundef{reportseries}{}{reportseries =  \{\thefield{reportseries}\},\par}%
\noindent\iffieldundef{reportvolume}{}{reportvolume =  \{\thefield{reportvolume}\},\par}%
\noindent\iffieldundef{reportyear}{}{reportyear =  \{\thefield{reportyear}\},\par}%
\noindent\iffieldundef{shipname}{}{shipname =  \{\thefield{shipname}\},\par}%
\noindent\iffieldundef{shortname}{}{shortname =  \{\thefield{shortname}\},\par}%
\noindent\iffieldundef{statutechapter}{}{statutechapter =  \{\thefield{statutechapter}\},\par}%
\noindent\iffieldundef{statutejurisdiction}{}{statutejurisdiction =  \{\thefield{statutejurisdiction}\},\par}%
\noindent\iffieldundef{statutelongtitle}{}{statutelongtitle =  \{\thefield{statutelongtitle}\},\par}%
\noindent\iffieldundef{statutenickname}{}{statutenickname =  \{\thefield{statutenickname}\},\par}%
\noindent\iffieldundef{statuteregnalyear}{}{statuteregnalyear =  \{\thefield{statuteregnalyear}\},\par}%
\noindent\iffieldundef{statuteshorttitle}{}{statuteshorttitle =  \{\thefield{statuteshorttitle}\},\par}%
\noindent\iffieldundef{statutetitle}{}{statutetitle =  \{\thefield{statutetitle}\},\par}%
\noindent\iffieldundef{statutetitleyear}{}{statutetitleyear =  \{\thefield{statutetitleyear}\},\par}%
\noindent\iffieldundef{statutevolume}{}{statutevolume =  \{\thefield{statutevolume}\},\par}%
\noindent\iffieldundef{statuteyear}{}{statuteyear =  \{\thefield{statuteyear}\},\par}%
\noindent\iffieldundef{svjy}{}{svjy =  \{\thefield{svjy}\},\par}%
\noindent\iffieldundef{title}{}{title =  \{\thefield{title}\},\par}%
\noindent\iffieldundef{url}{}{url =  \{\thefield{url}\},\par}%
\noindent\iffieldundef{volume}{}{volume =  \{\thefield{volume}\},\par}%
\noindent\iffieldundef{volyearneeded}{}{volyearneeded =  \{\thefield{volyearneeded}\},\par}%
\noindent\iffieldundef{year}{}{year =  \{\thefield{year}\},\par}%
\noindent\iffieldundef{crossref}{}{crossref =  \{\thefield{crossref}\},\par}%
\noindent\iffieldundef{xdata}{}{xdata =  \{\thefield{xdata}\},\par}%
\noindent\iffieldundef{related}{}{related =  \{\thefield{related}\},\par}%
\}\par%
}}




\newbibmacro{getlcdallfields}{%
{%
\ttfamily\ \par
@\thefield{entrytype}\{\thefield{entrykey},\par%
\noindent\iffieldundef{abstract}{}{abstract =  \{\thefield{abstract}\},\par}%
\noindent\iffieldundef{addendum}{}{addendum =  \{\thefield{addendum}\},\par}%
\noindent\iffieldundef{afterword}{}{afterword =  \{\thefield{afterword}\},\par}%
\noindent\iffieldundef{annotation}{}{annotation =  \{\thefield{annotation}\},\par}%
\noindent\iffieldundef{annotator}{}{annotator =  \{\thefield{annotator}\},\par}%
\noindent\iffieldundef{article}{}{article =  \{\thefield{article}\},\par}%
\noindent\ifnameundef{author}{}{author =  \{\thename{author}\},\par}%
\noindent\iffieldundef{authortype}{}{authortype =  \{\thefield{authortype}\},\par}%
\noindent\iffieldundef{book}{}{book =  \{\thefield{book}\},\par}%
\noindent\iffieldundef{bookauthor}{}{bookauthor =  \{\thefield{bookauthor}\},\par}%
\noindent\iffieldundef{bookinbook}{}{bookinbook =  \{\thefield{bookinbook}\},\par}%
\noindent\iffieldundef{booklet}{}{booklet =  \{\thefield{booklet}\},\par}%
\noindent\iffieldundef{bookpagination}{}{bookpagination =  \{\thefield{bookpagination}\},\par}%
\noindent\iffieldundef{booksubtitle}{}{booksubtitle =  \{\thefield{booksubtitle}\},\par}%
\noindent\iffieldundef{booktitle}{}{booktitle =  \{\thefield{booktitle}\},\par}%
\noindent\iffieldundef{booktitleaddon}{}{booktitleaddon =  \{\thefield{booktitleaddon}\},\par}%
\noindent\iffieldundef{chapter}{}{chapter =  \{\thefield{chapter}\},\par}%
\noindent\iffieldundef{collection}{}{collection =  \{\thefield{collection}\},\par}%
\noindent\iffieldundef{commentator}{}{commentator =  \{\thefield{commentator}\},\par}%
\noindent\iffieldundef{crossref}{}{crossref =  \{\thefield{crossref}\},\par}%
\noindent\iffieldundef{day}{}{day =  \{\thefield{day}\},\par}%
\noindent\iffieldundef{doi}{}{doi =  \{\thefield{doi}\},\par}%
\noindent\iffieldundef{edition}{}{edition =  \{\thefield{edition}\},\par}%
\noindent\iffieldundef{editor}{}{editor =  \{\thefield{editor}\},\par}%
\noindent\iffieldundef{editora}{}{editora =  \{\thefield{editora}\},\par}%
\noindent\iffieldundef{editoratype}{}{editoratype =  \{\thefield{editoratype}\},\par}%
\noindent\iffieldundef{editorb}{}{editorb =  \{\thefield{editorb}\},\par}%
\noindent\iffieldundef{editorbtype}{}{editorbtype =  \{\thefield{editorbtype}\},\par}%
\noindent\iffieldundef{editorc}{}{editorc =  \{\thefield{editorc}\},\par}%
\noindent\iffieldundef{editorctype}{}{editorctype =  \{\thefield{editorctype}\},\par}%
\noindent\iffieldundef{editortype}{}{editortype =  \{\thefield{editortype}\},\par}%
\noindent\iffieldundef{eid}{}{eid =  \{\thefield{eid}\},\par}%
\noindent\iffieldundef{endday}{}{endday =  \{\thefield{endday}\},\par}%
\noindent\iffieldundef{endhour}{}{endhour =  \{\thefield{endhour}\},\par}%
\noindent\iffieldundef{endminute}{}{endminute =  \{\thefield{endminute}\},\par}%
\noindent\iffieldundef{endmonth}{}{endmonth =  \{\thefield{endmonth}\},\par}%
\noindent\iffieldundef{endseason}{}{endseason =  \{\thefield{endseason}\},\par}%
\noindent\iffieldundef{endsecond}{}{endsecond =  \{\thefield{endsecond}\},\par}%
\noindent\iffieldundef{endtimezone}{}{endtimezone =  \{\thefield{endtimezone}\},\par}%
\noindent\iffieldundef{endyear}{}{endyear =  \{\thefield{endyear}\},\par}%
\noindent\iffieldundef{entryset}{}{entryset =  \{\thefield{entryset}\},\par}%
\noindent\iffieldundef{entrysubtype}{}{entrysubtype =  \{\thefield{entrysubtype}\},\par}%
\noindent\iffieldundef{eprint}{}{eprint =  \{\thefield{eprint}\},\par}%
\noindent\iffieldundef{eprintclass}{}{eprintclass =  \{\thefield{eprintclass}\},\par}%
\noindent\iffieldundef{eprinttype}{}{eprinttype =  \{\thefield{eprinttype}\},\par}%
\noindent\iffieldundef{eventday}{}{eventday =  \{\thefield{eventday}\},\par}%
\noindent\iffieldundef{eventendday}{}{eventendday =  \{\thefield{eventendday}\},\par}%
\noindent\iffieldundef{eventendhour}{}{eventendhour =  \{\thefield{eventendhour}\},\par}%
\noindent\iffieldundef{eventendminute}{}{eventendminute =  \{\thefield{eventendminute}\},\par}%
\noindent\iffieldundef{eventendmonth}{}{eventendmonth =  \{\thefield{eventendmonth}\},\par}%
\noindent\iffieldundef{eventendseason}{}{eventendseason =  \{\thefield{eventendseason}\},\par}%
\noindent\iffieldundef{eventendsecond}{}{eventendsecond =  \{\thefield{eventendsecond}\},\par}%
\noindent\iffieldundef{eventendtimezone}{}{eventendtimezone =  \{\thefield{eventendtimezone}\},\par}%
\noindent\iffieldundef{eventendyear}{}{eventendyear =  \{\thefield{eventendyear}\},\par}%
\noindent\iffieldundef{eventhour}{}{eventhour =  \{\thefield{eventhour}\},\par}%
\noindent\iffieldundef{eventminute}{}{eventminute =  \{\thefield{eventminute}\},\par}%
\noindent\iffieldundef{eventmonth}{}{eventmonth =  \{\thefield{eventmonth}\},\par}%
\noindent\iffieldundef{eventseason}{}{eventseason =  \{\thefield{eventseason}\},\par}%
\noindent\iffieldundef{eventsecond}{}{eventsecond =  \{\thefield{eventsecond}\},\par}%
\noindent\iffieldundef{eventtimezone}{}{eventtimezone =  \{\thefield{eventtimezone}\},\par}%
\noindent\iffieldundef{eventtitle}{}{eventtitle =  \{\thefield{eventtitle}\},\par}%
\noindent\iffieldundef{eventtitleaddon}{}{eventtitleaddon =  \{\thefield{eventtitleaddon}\},\par}%
\noindent\iffieldundef{eventyear}{}{eventyear =  \{\thefield{eventyear}\},\par}%
\noindent\iffieldundef{execute}{}{execute =  \{\thefield{execute}\},\par}%
\noindent\iffieldundef{file}{}{file =  \{\thefield{file}\},\par}%
\noindent\iffieldundef{foreword}{}{foreword =  \{\thefield{foreword}\},\par}%
\noindent\iffieldundef{gender}{}{gender =  \{\thefield{gender}\},\par}%
\noindent\iffieldundef{holder}{}{holder =  \{\thefield{holder}\},\par}%
\noindent\iffieldundef{hour}{}{hour =  \{\thefield{hour}\},\par}%
\noindent\iffieldundef{howpublished}{}{howpublished =  \{\thefield{howpublished}\},\par}%
\noindent\iffieldundef{ids}{}{ids =  \{\thefield{ids}\},\par}%
\noindent\iffieldundef{inbook}{}{inbook =  \{\thefield{inbook}\},\par}%
\noindent\iffieldundef{incollection}{}{incollection =  \{\thefield{incollection}\},\par}%
\noindent\iffieldundef{indexsorttitle}{}{indexsorttitle =  \{\thefield{indexsorttitle}\},\par}%
\noindent\iffieldundef{indextitle}{}{indextitle =  \{\thefield{indextitle}\},\par}%
\noindent\iffieldundef{inproceedings}{}{inproceedings =  \{\thefield{inproceedings}\},\par}%
\noindent\iffieldundef{inreference}{}{inreference =  \{\thefield{inreference}\},\par}%
\noindent\iffieldundef{institution}{}{institution =  \{\thefield{institution}\},\par}%
\noindent\iffieldundef{introduction}{}{introduction =  \{\thefield{introduction}\},\par}%
\noindent\iffieldundef{isan}{}{isan =  \{\thefield{isan}\},\par}%
\noindent\iffieldundef{isbn}{}{isbn =  \{\thefield{isbn}\},\par}%
\noindent\iffieldundef{ismn}{}{ismn =  \{\thefield{ismn}\},\par}%
\noindent\iffieldundef{isrn}{}{isrn =  \{\thefield{isrn}\},\par}%
\noindent\iffieldundef{issn}{}{issn =  \{\thefield{issn}\},\par}%
\noindent\iffieldundef{issue}{}{issue =  \{\thefield{issue}\},\par}%
\noindent\iffieldundef{issuesubtitle}{}{issuesubtitle =  \{\thefield{issuesubtitle}\},\par}%
\noindent\iffieldundef{issuetitle}{}{issuetitle =  \{\thefield{issuetitle}\},\par}%
\noindent\iffieldundef{issuetitleaddon}{}{issuetitleaddon =  \{\thefield{issuetitleaddon}\},\par}%
\noindent\iffieldundef{iswc}{}{iswc =  \{\thefield{iswc}\},\par}%
\noindent\iffieldundef{journalsubtitle}{}{journalsubtitle =  \{\thefield{journalsubtitle}\},\par}%
\noindent\iffieldundef{journaltitle}{}{journaltitle =  \{\thefield{journaltitle}\},\par}%
\noindent\iffieldundef{journaltitleaddon}{}{journaltitleaddon =  \{\thefield{journaltitleaddon}\},\par}%
\noindent\iffieldundef{keywords}{}{keywords =  \{\thefield{keywords}\},\par}%
\noindent\iffieldundef{label}{}{label =  \{\thefield{label}\},\par}%
\noindent\iffieldundef{langid}{}{langid =  \{\thefield{langid}\},\par}%
\noindent\iffieldundef{langidopts}{}{langidopts =  \{\thefield{langidopts}\},\par}%
\noindent\iffieldundef{language}{}{language =  \{\thefield{language}\},\par}%
\noindent\iffieldundef{library}{}{library =  \{\thefield{library}\},\par}%
%%\noindent\iffieldundef{lista}{}{lista =  \{\thefield{lista}\},\par}%
%%\noindent\iffieldundef{listb}{}{listb =  \{\thefield{listb}\},\par}%
%%\noindent\iffieldundef{listc}{}{listc =  \{\thefield{listc}\},\par}%
%%\noindent\iffieldundef{listd}{}{listd =  \{\thefield{listd}\},\par}%
%%\noindent\iffieldundef{liste}{}{liste =  \{\thefield{liste}\},\par}%
%%\noindent\iffieldundef{listf}{}{listf =  \{\thefield{listf}\},\par}%
%%\noindent\iffieldundef{location}{}{location =  \{\thefield{location}\},\par}%
%%\noindent\iffieldundef{mainsubtitle}{}{mainsubtitle =  \{\thefield{mainsubtitle}\},\par}%
%%\noindent\iffieldundef{maintitle}{}{maintitle =  \{\thefield{maintitle}\},\par}%
%%\noindent\iffieldundef{maintitleaddon}{}{maintitleaddon =  \{\thefield{maintitleaddon}\},\par}%
%%\noindent\iffieldundef{manual}{}{manual =  \{\thefield{manual}\},\par}%
%%\noindent\iffieldundef{minute}{}{minute =  \{\thefield{minute}\},\par}%
%%\noindent\iffieldundef{misc}{}{misc =  \{\thefield{misc}\},\par}%
%%\noindent\iffieldundef{month}{}{month =  \{\thefield{month}\},\par}%
%%\noindent\iffieldundef{mvbook}{}{mvbook =  \{\thefield{mvbook}\},\par}%
%%\noindent\iffieldundef{mvcollection}{}{mvcollection =  \{\thefield{mvcollection}\},\par}%
%%\noindent\iffieldundef{namea}{}{namea =  \{\thefield{namea}\},\par}%
%%\noindent\iffieldundef{nameaddon}{}{nameaddon =  \{\thefield{nameaddon}\},\par}%
%%\noindent\iffieldundef{nameatype}{}{nameatype =  \{\thefield{nameatype}\},\par}%
%%\noindent\iffieldundef{nameb}{}{nameb =  \{\thefield{nameb}\},\par}%
%%\noindent\iffieldundef{namebtype}{}{namebtype =  \{\thefield{namebtype}\},\par}%
%%\noindent\iffieldundef{namec}{}{namec =  \{\thefield{namec}\},\par}%
%%\noindent\iffieldundef{namectype}{}{namectype =  \{\thefield{namectype}\},\par}%
%%\noindent\iffieldundef{note}{}{note =  \{\thefield{note}\},\par}%
%%\noindent\iffieldundef{number}{}{number =  \{\thefield{number}\},\par}%
%%\noindent\iffieldundef{online}{}{online =  \{\thefield{online}\},\par}%
%%\noindent\iffieldundef{options}{}{options =  \{\thefield{options}\},\par}%
%%\noindent\iffieldundef{organization}{}{organization =  \{\thefield{organization}\},\par}%
%%\noindent\iffieldundef{origday}{}{origday =  \{\thefield{origday}\},\par}%
%%\noindent\iffieldundef{origendday}{}{origendday =  \{\thefield{origendday}\},\par}%
%%\noindent\iffieldundef{origendhour}{}{origendhour =  \{\thefield{origendhour}\},\par}%
%%\noindent\iffieldundef{origendminute}{}{origendminute =  \{\thefield{origendminute}\},\par}%
%%\noindent\iffieldundef{origendmonth}{}{origendmonth =  \{\thefield{origendmonth}\},\par}%
%%\noindent\iffieldundef{origendseason}{}{origendseason =  \{\thefield{origendseason}\},\par}%
%%\noindent\iffieldundef{origendsecond}{}{origendsecond =  \{\thefield{origendsecond}\},\par}%
%%\noindent\iffieldundef{origendtimezone}{}{origendtimezone =  \{\thefield{origendtimezone}\},\par}%
%%\noindent\iffieldundef{origendyear}{}{origendyear =  \{\thefield{origendyear}\},\par}%
%%\noindent\iffieldundef{orighour}{}{orighour =  \{\thefield{orighour}\},\par}%
%%\noindent\iffieldundef{origlanguage}{}{origlanguage =  \{\thefield{origlanguage}\},\par}%
%%\noindent\iffieldundef{origlocation}{}{origlocation =  \{\thefield{origlocation}\},\par}%
%%\noindent\iffieldundef{origminute}{}{origminute =  \{\thefield{origminute}\},\par}%
%%\noindent\iffieldundef{origmonth}{}{origmonth =  \{\thefield{origmonth}\},\par}%
%%\noindent\iffieldundef{origpublisher}{}{origpublisher =  \{\thefield{origpublisher}\},\par}%
%%\noindent\iffieldundef{origseason}{}{origseason =  \{\thefield{origseason}\},\par}%
%%\noindent\iffieldundef{origsecond}{}{origsecond =  \{\thefield{origsecond}\},\par}%
%%\noindent\iffieldundef{origtimezone}{}{origtimezone =  \{\thefield{origtimezone}\},\par}%
%%\noindent\iffieldundef{origtitle}{}{origtitle =  \{\thefield{origtitle}\},\par}%
%%\noindent\iffieldundef{origyear}{}{origyear =  \{\thefield{origyear}\},\par}%
%%\noindent\iffieldundef{pages}{}{pages =  \{\thefield{pages}\},\par}%
%%\noindent\iffieldundef{pagetotal}{}{pagetotal =  \{\thefield{pagetotal}\},\par}%
%%\noindent\iffieldundef{pagination}{}{pagination =  \{\thefield{pagination}\},\par}%
%%\noindent\iffieldundef{part}{}{part =  \{\thefield{part}\},\par}%
%%\noindent\iffieldundef{patent}{}{patent =  \{\thefield{patent}\},\par}%
%%\noindent\iffieldundef{periodical}{}{periodical =  \{\thefield{periodical}\},\par}%
%%\noindent\iffieldundef{presort}{}{presort =  \{\thefield{presort}\},\par}%
%%\noindent\iffieldundef{proceedings}{}{proceedings =  \{\thefield{proceedings}\},\par}%
\noindent\ifnameundef{publisher}{}{publisher =  \{\thename{publisher}\},\par}%
%%\noindent\iffieldundef{pubstate}{}{pubstate =  \{\thefield{pubstate}\},\par}%
%%\noindent\iffieldundef{reference}{}{reference =  \{\thefield{reference}\},\par}%
%%\noindent\iffieldundef{related}{}{related =  \{\thefield{related}\},\par}%
%%\noindent\iffieldundef{relatedoptions}{}{relatedoptions =  \{\thefield{relatedoptions}\},\par}%
%%\noindent\iffieldundef{relatedstring}{}{relatedstring =  \{\thefield{relatedstring}\},\par}%
%%\noindent\iffieldundef{relatedtype}{}{relatedtype =  \{\thefield{relatedtype}\},\par}%
%%\noindent\iffieldundef{report}{}{report =  \{\thefield{report}\},\par}%
%%\noindent\iffieldundef{reprinttitle}{}{reprinttitle =  \{\thefield{reprinttitle}\},\par}%
%%\noindent\iffieldundef{season}{}{season =  \{\thefield{season}\},\par}%
%%\noindent\iffieldundef{second}{}{second =  \{\thefield{second}\},\par}%
%%\noindent\iffieldundef{series}{}{series =  \{\thefield{series}\},\par}%
%%\noindent\iffieldundef{set}{}{set =  \{\thefield{set}\},\par}%
%%\noindent\iffieldundef{shortauthor}{}{shortauthor =  \{\thefield{shortauthor}\},\par}%
%%\noindent\iffieldundef{shorteditor}{}{shorteditor =  \{\thefield{shorteditor}\},\par}%
%%\noindent\iffieldundef{shorthand}{}{shorthand =  \{\thefield{shorthand}\},\par}%
%%\noindent\iffieldundef{shorthandintro}{}{shorthandintro =  \{\thefield{shorthandintro}\},\par}%
%%\noindent\iffieldundef{shortjournal}{}{shortjournal =  \{\thefield{shortjournal}\},\par}%
%%\noindent\iffieldundef{shortseries}{}{shortseries =  \{\thefield{shortseries}\},\par}%
%%\noindent\iffieldundef{shorttitle}{}{shorttitle =  \{\thefield{shorttitle}\},\par}%
%%\noindent\iffieldundef{sortkey}{}{sortkey =  \{\thefield{sortkey}\},\par}%
%%\noindent\iffieldundef{sortname}{}{sortname =  \{\thefield{sortname}\},\par}%
%%\noindent\iffieldundef{sortshorthand}{}{sortshorthand =  \{\thefield{sortshorthand}\},\par}%
%%\noindent\iffieldundef{sorttitle}{}{sorttitle =  \{\thefield{sorttitle}\},\par}%
%%\noindent\iffieldundef{sortyear}{}{sortyear =  \{\thefield{sortyear}\},\par}%
%%\noindent\iffieldundef{subtitle}{}{subtitle =  \{\thefield{subtitle}\},\par}%
%%\noindent\iffieldundef{suppbook}{}{suppbook =  \{\thefield{suppbook}\},\par}%
%%\noindent\iffieldundef{suppcollection}{}{suppcollection =  \{\thefield{suppcollection}\},\par}%
%%\noindent\iffieldundef{suppperiodical}{}{suppperiodical =  \{\thefield{suppperiodical}\},\par}%
%%\noindent\iffieldundef{thesis}{}{thesis =  \{\thefield{thesis}\},\par}%
%%\noindent\iffieldundef{timezone}{}{timezone =  \{\thefield{timezone}\},\par}%
%%\noindent\iffieldundef{title}{}{title =  \{\thefield{title}\},\par}%
%%\noindent\iffieldundef{titleaddon}{}{titleaddon =  \{\thefield{titleaddon}\},\par}%
%%\noindent\iffieldundef{translator}{}{translator =  \{\thefield{translator}\},\par}%
%%\noindent\iffieldundef{type}{}{type =  \{\thefield{type}\},\par}%
%%\noindent\iffieldundef{unpublished]{}{}{unpublished]{ =  \{\thefield{unpublished]{}\},\par}%
%%\noindent\iffieldundef{url}{}{url =  \{\thefield{url}\},\par}%
%%\noindent\iffieldundef{urlday}{}{urlday =  \{\thefield{urlday}\},\par}%
%%\noindent\iffieldundef{urlendday}{}{urlendday =  \{\thefield{urlendday}\},\par}%
%%\noindent\iffieldundef{urlendhour}{}{urlendhour =  \{\thefield{urlendhour}\},\par}%
%%\noindent\iffieldundef{urlendminute}{}{urlendminute =  \{\thefield{urlendminute}\},\par}%
%%\noindent\iffieldundef{urlendmonth}{}{urlendmonth =  \{\thefield{urlendmonth}\},\par}%
%%\noindent\iffieldundef{urlendsecond}{}{urlendsecond =  \{\thefield{urlendsecond}\},\par}%
%%\noindent\iffieldundef{urlendtimezone}{}{urlendtimezone =  \{\thefield{urlendtimezone}\},\par}%
%%\noindent\iffieldundef{urlendyear}{}{urlendyear =  \{\thefield{urlendyear}\},\par}%
%%\noindent\iffieldundef{urlhour}{}{urlhour =  \{\thefield{urlhour}\},\par}%
%%\noindent\iffieldundef{urlminute}{}{urlminute =  \{\thefield{urlminute}\},\par}%
%%\noindent\iffieldundef{urlmonth}{}{urlmonth =  \{\thefield{urlmonth}\},\par}%
%%\noindent\iffieldundef{urlsecond}{}{urlsecond =  \{\thefield{urlsecond}\},\par}%
%%\noindent\iffieldundef{urltimezone}{}{urltimezone =  \{\thefield{urltimezone}\},\par}%
%%\noindent\iffieldundef{urlyear}{}{urlyear =  \{\thefield{urlyear}\},\par}%
%%\noindent\iffieldundef{usera}{}{usera =  \{\thefield{usera}\},\par}%
%%\noindent\iffieldundef{userb}{}{userb =  \{\thefield{userb}\},\par}%
%%\noindent\iffieldundef{userc}{}{userc =  \{\thefield{userc}\},\par}%
%%\noindent\iffieldundef{userd}{}{userd =  \{\thefield{userd}\},\par}%
%%\noindent\iffieldundef{usere}{}{usere =  \{\thefield{usere}\},\par}%
%%\noindent\iffieldundef{userf}{}{userf =  \{\thefield{userf}\},\par}%
%%\noindent\iffieldundef{venue}{}{venue =  \{\thefield{venue}\},\par}%
%%\noindent\iffieldundef{verba}{}{verba =  \{\thefield{verba}\},\par}%
%%\noindent\iffieldundef{verbb}{}{verbb =  \{\thefield{verbb}\},\par}%
%%\noindent\iffieldundef{verbc}{}{verbc =  \{\thefield{verbc}\},\par}%
%%\noindent\iffieldundef{version}{}{version =  \{\thefield{version}\},\par}%
%%\noindent\iffieldundef{volume}{}{volume =  \{\thefield{volume}\},\par}%
%%\noindent\iffieldundef{volumes}{}{volumes =  \{\thefield{volumes}\},\par}%
%%\noindent\iffieldundef{xdata}{}{xdata =  \{\thefield{xdata}\},\par}%
%%\noindent\iffieldundef{xref}{}{xref =  \{\thefield{xref}\},\par}%
%%\noindent\iffieldundef{year}{}{year =  \{\thefield{year}\},\par}%
}}




%============= lcdcase
\DeclareCiteCommand{lcdcase}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getlcdcase}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%


%============= lcdallfields
\DeclareCiteCommand{lcdallfields}%
%@@@@@@@@@@@@@@@@ prenote
{\usebibmacro{prenote}}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getlcdallfields}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{\multicitedelim}%
%@@@@@@@@@@@@@@@@ postnote
{\usebibmacro{postnote}}%


% sundry commands
%index
%%\newcommand\printlcindexes{%
%%\iftoggle{printlegtoc}{%
%%\let\oldtwocolumn\twocolumn
%%\renewcommand{\twocolumn}[1][]{#1}
%%\let\oldclearpage\clearpage
%%\renewcommand\clearpage{\relax}
%%\printindex[cases]
%%\printindex[legislation]
%%\renewcommand{\twocolumn}[1][]{\oldtwocolumn}
%%\renewcommand\clearpage{\oldclearpage}
%%}{}
%%\bigskip
%%\hrule%{0.8\linewidth}
%%\bigskip
%%}

%https://tex.stackexchange.com/questions/166414/including-cover-pictures-in-bibliography

\renewbibmacro*{finentry}{\finentry
  \iffieldundef{thumbnail}
    {}
    {\marginpar{\usefield{\insertbibimage}{thumbnail}}}}

%===================
\newcommand\lcsetindexingoff{\togglefalse{lcindexing}}
\newcommand\lcsetindexingon{\toggletrue{lcindexing}}


%=================== utility macros: display the bibentry using all cite commands
%----------------------
\newcommand\sdfs[1]{{\ttfamily\small\color{blue} \textbackslash #1\space\dotfill\space}}
\newcommand\sdft[1]{{\ttfamily\small\color{blue}\textbackslash #1}}


%\lcsetdemooff
\newcommand\lcdemolabelw{6cm}
\newcommand\lccitedemowidth{6cm}
%===============================================
\newcommand\lccitedemo[2]{%
\renewcommand\lcdemolabelw{\lccitedemowidth}

\noindent\fbox{#1}\vspace{2pt}

\lcsetstyledefault\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (default)}}Text\lawcite[#2]{#1}

\lcsetstylemlr\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (MLR)}}\lawcite[#2]{#1}

\lcsetstylemcgill\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (McGill)}}Text\lawcite[#2]{#1}

\lcsetstyleindigo\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (Indigo)}}\lawcite[#2]{#1}

\lcsetstyleaglc\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (AGLC)}}Text\lawcite[#2]{#1}

\lcsetstyledefault\setallabove\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (all above)}}\lawcite[#2]{#1}

\settitleonly\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (name only)}}\lawcite[#2]{#1}
\lcsetstyledefault%\medskip

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcinline}}\lcinline[#2]{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcinlinenn}}\lcinlinenn[#2]{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcfoot}}Text\lcfoot[#2]{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcnickname}}\lcnickname{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcitetitle}}\lawcitetitle{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawciteref}}\lawciteref{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcrefnn}}\lcrefnn{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcnote}}\lcnote{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcpostnote}}\lcpostnote[#2]{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcshorttitle}}\lcshorttitle{#1}

}


\newcommand\lccitedemowidthrr{5cm}
%===============================================
\newcommand\lccitedemorr[1]{%
\renewcommand\lcdemolabelw{\lccitedemowidthrr}

\noindent\fbox{#1}\vspace{2pt}

%\lcsetstyledefault\noindent\makebox[\lcdemolabelw][l]{lawcite (default)}Text\lawcite{#1}
%
%\lcsetstylemlr\noindent\makebox[\lcdemolabelw][l]{lawcite (MLR)}\lawcite{#1}
%
%\lcsetstylemcgill\noindent\makebox[\lcdemolabelw][l]{lawcite (McGill)}Text\lawcite{#1}
%
%\lcsetstyledefault\setallabove\noindent\makebox[\lcdemolabelw][l]{lawcite (all above)}\lawcite{#1}
%
%\settitleonly\noindent\makebox[\lcdemolabelw][l]{lawcite (name only)}\lawcite{#1}
%\lcsetstyledefault\medskip

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcinlinerr}}\lcinlinerr{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcinlinennrr}}\lcinlinennrr{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcfootrr}}Text\lcfootrr{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcnicknamerr}}\lcnicknamerr{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcitetitlerr}}\lawcitetitlerr{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawciterefrr}}\lawciterefrr{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcrefnnrr}}\lcrefnnrr{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcnoterr}}\lcnoterr{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcshorttitlerr}}\lcshorttitlerr{#1}

}




%===============================================





\newcommand\lccitedemowidthstat{5.5cm}
%===============================================
\newcommand\lccitedemostat[1]{%
\renewcommand\lcdemolabelw{\lccitedemowidthstat}

\noindent\fbox{#1}\vspace{2pt}

\lcsetstyledefault\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (default)}}\lawcite{#1}

\lcsetstylemlr\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (MLR)}}\lawcite{#1}

\lcsetstylemcgill\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (McGill)}}\lawcite{#1}

\lcsetstyledefault\setallabove\noindent\makebox[\lcdemolabelw][l]{\sdfs{lawcite (all above)}}\lawcite{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcciteref}}\lcciteref{#1}

}


\newcommand\lccitedemowidthlj{5cm}
%===============================================
\newcommand\lccitedemolj[1]{%
\renewcommand\lcdemolabelw{\lccitedemowidthlj}

\noindent\fbox{#1}\vspace{2pt}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{ljcite}}\ljcite{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcljauthor}}\lcljauthor{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcljauthorfn}}\lcljauthorfn{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcljtitle}}\lcljtitle{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcljyear}}\lcljyear{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcljvolume}}\lcljvolume{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcljjournaltitle}}\lcljjournaltitle{#1}

\noindent\makebox[\lcdemolabelw][l]{\sdfs{lcljpage}}\lcljpage{#1}
}


%=================== print the index
\newcommand\printlawciteindexes{%
\iftoggle{printlegtoc}{%
\let\oldtwocolumn\twocolumn
\renewcommand{\twocolumn}[1][]{##1}
\let\oldclearpage\clearpage
\renewcommand\clearpage{\relax}
\printindex[cases]
\printindex[legislation]
\iftoggle{printregulations}{\printindex[regulations]}{}
\renewcommand{\twocolumn}[1][]{\oldtwocolumn}
\renewcommand\clearpage{\oldclearpage}
}{}
}
%========================================== `lite' cite
\DeclareRefcontext{legalcase}{sorting=casesort}
\DeclareRefcontext{legalstat}{sorting=statsort}
\DeclareRefcontext{legalcasestat}{sorting=casestat}

\defbibheading{lm}{%
\section*{Legal Material}}

%============= legal
\DeclareFieldFormat[jurisdiction]{title}{\mkbibemph{#1}}
\DeclareFieldFormat[jurisdiction]{number}{#1}
\DeclareListFormat[jurisdiction]{location}{%
\mkbibparens{#1%
\ifthenelse{\value{listcount}<\value{liststop}}%
{\addcomma\space}%
{}}}

\newbibmacro{lclgetlegaltitle}{%
\printfield{title}%
}
\newbibmacro{lclgetlegalrefcase}{%
\iffieldundef{number}{}{\printfield{number}}%
}

\newbibmacro{lclgetlegalrefstat}{%
\iflistundef{location}{}{\printlist{location}}%
}

\newbibmacro{lclgetlegalref}{%
\usebibmacro{lclgetlegalrefstat}%
\usebibmacro{lclgetlegalrefcase}%
}




\newbibmacro{lclgetlegalfull}{%
\ifboolexpr{%
test {\ifentrytype{jurisdiction}}%
}%
{%true: jurisdiction entrytype
\usebibmacro{lclgetlegaltitle}%
\addspace%
\usebibmacro{lclgetlegalref}%
}%
{%false = not jurisdiction entrytype
\mkbibemph{\thefield{title}}%
\iffieldundef{number}{}{\addspace\thefield{number}}%case
\iflistundef{location}{}{\addspace\mkbibparens{\printlist{location}}}%statute
}%
}

\DeclareCiteCommand{legal}%
{%
\usebibmacro{prenote}%
}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{lclgetlegalfull}%
}%end item
%@@@@@@@@@@@@@@@@ delim
{%
\multicitedelim%
}%
%@@@@@@@@@@@@@@@@ postnote
{%
\usebibmacro{postnote}%
}

%
\DeclareBibliographyDriver{jurisdiction}{%
 \usebibmacro{begentry}%
   \usebibmacro{lclgetlegalfull}%
 \usebibmacro{finentry}
}




%-------------------------
%\DeclareFieldFormat{courtname}{#1}%already defined
\DeclareFieldFormat{courtdivision}{#1}
\DeclareFieldFormat{courtlist}{#1}
\DeclareFieldFormat{courtjurisdiction}{#1}
\DeclareFieldFormat{courtcasenumber}{#1}


\newbibmacro{getcaseproc}{%
\iffieldundef{courtname}{}{\addcomma\addspace\printfield{courtname}}%
\iffieldundef{courtdivision}{}{\addcomma\addspace\printfield{courtdivision}}%
\iffieldundef{courtlist}{}{\addcomma\addspace\printfield{courtlist}}%
\iffieldundef{courtjurisdiction}{}{\addcomma\addspace\printfield{courtjurisdiction}}%
\iffieldundef{courtcasenumber}{}{\addcomma\addspace\printfield{courtcasenumber}}%
}



\newbibmacro{getproc}{%
\ifciteseen{\usebibmacro{getcasename}}{%
 \usebibmacro{getcasename}%
  \usebibmacro{getcaseproc}}%
}

\newbibmacro{indexcaseparm}{%
\sindex[cases]{%
\thefield{partya}\thefield{partyb}@%for sorting
%partynames = casename
\iftoggle{partynamesitalic}{%start italic
\textit{%
\iffieldundef{shipname}{\thefield{partya}\iffieldundef{partyajur}{}{ (\thefield{partyajur})}%no space, for one party only; space if partyb (before v)
\iffieldundef{partyb}{}{ \iffieldundef{partysep}{\iftoggle{partysepitalic}{\textit{v}}{\textup{v}}}{\iftoggle{partysepitalic}{\textit{\thefield{partysep}}}{\textup{\thefield{partysep}}}}\iftoggle{partysepdotted}{.}{} \thefield{partyb}\iffieldundef{partybjur}{}{ (\thefield{partybjur})}}}{\thefield{shipname}, The}}}%end italic
{%
\iffieldundef{shipname}{\thefield{partya}\iffieldundef{partyajur}{}{ (\thefield{partyajur})}%no space, for one party only; space if partyb (before v)
\iffieldundef{partyb}{}{ \iffieldundef{partysep}{\iftoggle{partysepitalic}{\textit{v}}{\textup{v}}}{\iftoggle{partysepitalic}{\textit{\thefield{partysep}}}{\textup{\thefield{partysep}}}}\iftoggle{partysepdotted}{.}{} \thefield{partyb}\iffieldundef{partybjur}{}{ (\thefield{partybjur})}}}{\thefield{shipname}, The}}%
%proceedings reference, if any
\iffieldundef{courtcasenumber}{}{%
\iffieldundef{courtname}{}{, \thefield{courtname}}%
\iffieldundef{courtdivision}{}{, \thefield{courtdivision}}%
\iffieldundef{courtlist}{}{, \thefield{courtlist}}%
\iffieldundef{courtjurisdiction}{}{, \thefield{courtjurisdiction}}%
, \thefield{courtcasenumber}}%
%caseref
\iftoggle{refintoc}{% 1st character is a space
\iftoggle{commainindex}{,}{}\addspace\iffieldundef{casenumber}{}{\iftoggle{mncbrackets}{[}{}\thefield{caseyear}\iftoggle{mncbrackets}{]}{} \thefield{courtname} \thefield{casenumber}}%
%\iffieldundef{reportpage}{}{\thefield{reportyear} \thefield{reportvolume} \thefield{reportseries} \thefield{reportpage}} %
\iffieldundef{reportpage}{}{%
\iffieldundef{casenumber}{}{, }% s/b delimiter ***
\iffieldundef{reportyear}{}{%
\iffieldundef{reportvolume}{ [}{%
\iffieldundef{volyearneeded}{ (}{ [}}%
\thefield{reportyear}%
\iffieldundef{reportvolume}{]}{%
\iffieldundef{volyearneeded}{)}{]}} }%
\thefield{reportvolume} %
\thefield{reportseries} %  use \mkbibordinal{}?
\thefield{reportpage}%
}%end if reportpage
}%end refintoc true
{%start refintoc false
\iffieldundef{icaseyear}{\iffieldundef{caseyear}{\iffieldundef{reportyear}{}{ (\thefield{reportyear})}}{ (\thefield{caseyear})}}{ (\thefield{icaseyear})}%
}%end refintoc false
\lcparnumrefsencap}%end sindex
}

\newbibmacro{getprocindex}{%
\usebibmacro{indexcaseparm}%
}%



%------------------------- (in-progress) proceedings
\DeclareCiteCommand{lcproc}%
{%
\usebibmacro{prenote}%
}%
%@@@@@@@@@@@@@@@@ item
{%
\usebibmacro{getproc}%
\usebibmacro{getprocindex}
}%end item
%@@@@@@@@@@@@@@@@ delim
{%
\multicitedelim%
}%
%@@@@@@@@@@@@@@@@ postnote
{%
\usebibmacro{postnote}%
}







%==========================================
%Numbered paragraphs: pre-formatting
\newcommand\numparshiftleft{}
\newcommand\numparfillright{}
\newcommand\numparindent{}
\newcommand\numparformat{}
\newcommand\numpardelimleft{[}
\newcommand\numpardelimright{]}
\newcommand\numpardelimpost{\ }
\newsavebox{\mybox}


%Numbered paragraphs
\newcounter{parno}%[paragraph]%% numbered paragraph
\renewcommand{\theparno}{\arabic{parno}}
\newcommand{\p}{\refstepcounter{parno}\noindent\numparshiftleft{\savebox{\mybox}{\mbox{\numparformat\numpardelimleft\theparno\numpardelimright}}\usebox{\mybox}}\label{para.\theparno}\numparfillright\numparindent\numpardelimpost}
\setcounter{secnumdepth}{4}
\setcounter{parno}{0}

%Numbered paragraphs: formatting
\newcommand\setnumparshiftleft[1]{\renewcommand\numparshiftleft{#1}}
\newcommand\setnumparfillright[1]{\renewcommand\numparfillright{#1}}
\newcommand\setnumparindent[1]{\renewcommand\numparindent{#1}}
\newcommand\setnumparformat[1]{\renewcommand\numparformat{#1}}
\newcommand\setnumpardelimleft[1]{\renewcommand\numpardelimleft{#1}}
\newcommand\setnumpardelimright[1]{\renewcommand\numpardelimright{#1}}
\newcommand\setnumpardelimpost[1]{\renewcommand\numpardelimpost{#1}}



%numbered paragraphs cross-referencing method
\newcommand\definname{para}
\newcommand{\paradef}[1]{\label{#1}}
%\newcommand\pararef[1]{\definname\ [\ref{#1}]}
\newcommand\pararef[1]{\definname\ \iftoggle{parabrackets}{[\ref{#1}]}{\ref{#1}}}

%user bib commands
\newcommand\lcat[1]{\bibstring{onlyat}~#1}
\newcommand\lcsec[1]{\bibstring{section}~#1}
\newcommand\lcsecyr[2]{\bibstring{section}~#1\addspace\mkbibparens{#2}}
\newcommand\lcssec[1]{\bibstring{sections}~#1}
\newcommand\lcssecyr[2]{\bibstring{sections}~#1\addspace\mkbibparens{#2}}
\newcommand\lcpara[1]{\mkbibbrackets{#1}}
\newcommand\lcparas[2]{\mkbibbrackets{#1}--\mkbibbrackets{#2}}
\newcommand\lcatpara[1]{\bibstring{atparagraph}\addspace\mkbibbrackets{#1}}
\newcommand\lcatparas[2]{\bibstring{atparagraph}\addspace\mkbibbrackets{#1}--\mkbibbrackets{#2}}

%===================
%misc general commands
\newcommand\setindexhyperlinks{%
\iftoggle{lcparnumrefs}{%
\renewcommand\myhyperref[1]{\ref{para.##1}}%
\renewcommand\lcparnumrefsencap{|myhyperref}%
}%end true
{%false
\renewcommand\myhyperref[1]{\hyperpage{##1}}%
\renewcommand\lcparnumrefsencap{|myhyperref}%
}%end false
}

\newcommand\setpostnotedelimoff{%
\DeclareFieldFormat{postnote}{##1}%
}
\newcommand\setpostnotedelimon{%
\DeclareFieldFormat{postnote}{\mkpageprefix[pagination][\mknormrange]{##1}}%
}


%===============================================
%===================
\endinput
